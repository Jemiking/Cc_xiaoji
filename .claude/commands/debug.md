问题诊断 - 定位 Bug 根因并提供修复方案

Arguments: $ARGUMENTS

## 🐛 问题诊断任务

调用 **debugger** agent 诊断问题、定位根因并提供修复方案。

## 问题描述

**问题信息**: $ARGUMENTS

## 执行流程

我将调用 **debugger** agent 执行问题诊断:

### 阶段 1: 收集信息

**1.1 理解问题描述**
- 具体的错误是什么?
- 错误什么时候发生?
- 如何复现?
- 期望行为 vs 实际行为?

**1.2 收集错误信息**
需要的信息:
- ✅ 错误堆栈信息
- ✅ 日志文件
- ✅ 控制台输出
- ✅ 复现步骤
- ✅ 环境信息

**1.3 调研相关代码**
- 调用 searcher 定位问题代码
- 使用 Grep 搜索错误信息
- 查找最近的修改

### 阶段 2: 问题分析

**2.1 分析错误堆栈**
- 从堆栈顶部开始分析
- 识别第一个项目代码(非依赖库)
- 定位到具体文件和行号
- 理解调用链

**2.2 代码审查**
- 阅读相关代码
- 理解逻辑流程
- 识别可能的问题点

**2.3 根因定位**
使用"5个为什么"方法:
- 为什么会出现这个错误?
- 为什么会有这个状态?
- 为什么没有被处理?
- ...
- 找到根本原因

**2.4 影响范围评估**
- 调用 searcher 查找所有调用
- 评估影响范围
- 确定修复优先级

### 阶段 3: 修复方案

**3.1 短期修复 (Quick Fix)**
- 快速解决当前问题
- 添加必要的检查和处理
- 确保不再出现同样错误

**3.2 长期修复 (Root Cause Fix)**
- 解决根本原因
- 添加输入验证
- 改进错误处理
- 使用类型系统防止错误

**3.3 预防措施**
- 添加单元测试覆盖边界情况
- 添加日志便于问题追踪
- 添加监控和告警

## 诊断技巧

**二分法调试:**
- 在中间位置添加日志
- 确定错误在哪个环节
- 继续二分直到定位

**对比调试:**
- 对比正常和异常的输入
- 对比最近的代码变更
- 找出差异点

**隔离调试:**
- 将复杂函数拆分
- 单独测试每个部分
- 使用 mock 隔离依赖

## 常见问题类型

**运行时错误:**
- TypeError, ReferenceError
- Null/Undefined 错误
- 异步错误
- 内存泄漏

**逻辑错误:**
- 计算结果错误
- 条件判断错误
- 状态管理错误

**性能问题:**
- 响应缓慢
- 内存占用过高
- CPU 使用率过高

**集成问题:**
- API 调用失败
- 数据库连接失败
- 第三方服务错误

## 预期输出

```markdown
## 问题诊断报告

### 问题概述
- 错误类型: [类型]
- 错误信息: [信息]
- 影响范围: [范围]
- 严重程度: 🔴 高 / 🟡 中 / 🟢 低

### 错误位置
- 文件: `path/to/file.ts:line`
- 函数: `functionName()`
- 调用链: [调用链]

### 根本原因
[5个为什么分析]
根因: [根本原因]

### 复现步骤
1. ...
2. ...

### 修复方案

#### 方案1: [名称] (推荐)
[代码示例]
优点: ...
缺点: ...

#### 方案2: [名称]
[代码示例]
优点: ...
缺点: ...

### 推荐方案
✅ 使用方案X,原因: ...

### 预防措施
- [ ] 添加输入验证
- [ ] 添加单元测试
- [ ] 添加错误日志
- [ ] 更新文档

### 影响评估
- 用户影响: ...
- 修复优先级: P0/P1/P2
- 修复时间: XX分钟
- 测试时间: XX分钟

### 相关问题
[类似问题的位置]
```

## 开始诊断

现在调用 debugger agent 开始问题诊断...
