# Excel导入导出格式对比分析

## 分析时间
2025-07-16

## 格式匹配问题汇总

### 1. 待办任务表 - 列名不一致
**问题**：
- 导出使用："描述"
- 导入查找："任务描述"

**影响**：导入时无法找到描述列，任务描述信息会丢失

### 2. 习惯记录表 - 多个列名不匹配
**问题1**：
- 导出使用："目标次数"
- 导入查找："目标频率"

**问题2**：
- 导出使用："创建时间"
- 导入查找："创建日期"

**影响**：导入时无法找到这些列，目标次数和创建时间信息会丢失

### 3. 待办任务表 - 缺少标签列
**问题**：
- 导出时：没有导出标签信息
- 导入时：尝试查找"标签"列

**影响**：虽然不会导致导入失败，但原有的标签信息未导出

### 4. 账户类型格式
**潜在问题**：
- 导出使用：`account.type.displayName`（中文名称，如"现金"、"银行卡"等）
- 导入期望：字符串类型名称

**需要验证**：displayName的值是否与导入时的类型匹配逻辑一致

### 5. 优先级格式
**潜在问题**：
- 导出使用：`task.priorityLevel.displayName`（可能是"高"、"中"、"低"）
- 导入解析：根据"高"、"中"、"低"转换为数字3、2、1

**影响**：如果displayName格式不同，优先级可能解析错误

### 6. 周期格式
**潜在问题**：
- 导出使用：`getPeriodDisplay(habit.period)`（转换为中文"每日"、"每周"、"每月"）
- 导入解析：根据中文转换回"daily"、"weekly"、"monthly"

**影响**：格式转换正确，但增加了不必要的复杂性

### 7. 日期时间格式
**格式说明**：
- 导出格式：使用`timestampAdapter.toLocalDateTimeString()`
- 导入解析：使用`SimpleDateFormat("yyyy-MM-dd HH:mm:ss")`

**需要验证**：timestampAdapter的输出格式是否为"yyyy-MM-dd HH:mm:ss"

## 数据完整性问题

### 1. 账户余额的期初值
- 导出时：包含期初余额行（类型为"-"，分类为"期初余额"）
- 导入时：跳过期初余额行
- **问题**：账户的初始余额信息可能丢失

### 2. 完成状态的任务
- 导出时：导出所有任务，包括已完成的
- 导入时：可以识别完成状态，但无法在批量创建后更新完成状态
- **问题**：已完成任务导入后会变成未完成状态

### 3. 连续天数和统计信息
- 导出时：导出当前连续天数、历史最长连续、总完成次数
- 导入时：这些字段被读取但无法通过API设置
- **问题**：习惯的历史统计信息会丢失

## 建议修复方案

### 优先级高（会导致导入失败）
1. 修改导入代码，使列名查找与导出一致：
   - 待办任务："任务描述" → "描述"
   - 习惯记录："目标频率" → "目标次数"
   - 习惯记录："创建日期" → "创建时间"

### 优先级中（数据丢失但不影响基本功能）
1. 导出时添加任务标签信息
2. 改进已完成任务的导入逻辑
3. 考虑保存和恢复习惯统计信息

### 优先级低（优化建议）
1. 统一日期时间格式处理
2. 简化周期格式转换逻辑
3. 添加导入时的数据验证和错误提示

## 测试建议

1. 使用实际导出的文件测试导入功能
2. 验证各种数据类型的转换是否正确
3. 测试大量数据的导入性能
4. 验证特殊字符和空值的处理