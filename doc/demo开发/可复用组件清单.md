# Demo 可复用组件清单

> **文档目的**: 记录 `feature:ledger` 模块下 `demo/stylecatalog` 环境中所有可复用的UI组件，方便团队成员了解和使用。

**维护日期**: 2025-09-30
**适用范围**: `feature/ledger/src/debug` 源集
**迁移计划**: Demo测试完善后，将逐步迁移到 `src/main` 正式环境

---

## 📦 组件总览

| 组件名称 | 功能描述 | 状态 | 文件大小 |
|---------|---------|------|---------|
| CustomDatePickerDialog | 双模式日期选择器 | ✅ 完成 | 36KB |
| BookSelectionBottomSheet | 账本选择底部弹窗 | ✅ 完成 | 9KB |
| NumberKeyboard | 数字键盘 | ✅ 完成 | 5KB |
| AddBillTopBar | 添加账单顶栏 | ✅ 完成 | 4KB |
| AmountInputSection | 金额输入区域 | ✅ 完成 | 4KB |
| CategoryGrid | 分类网格 | ✅ 完成 | 3KB |
| CategoryIcons | 分类图标 | ✅ 完成 | 4KB |
| SvgIconLoader | SVG图标加载器 | ✅ 完成 | 5KB |

---

## 1️⃣ CustomDatePickerDialog（日期选择器）⭐

### 📝 组件概述

一个功能强大的日期选择组件，支持**日历网格**和**滚轮选择**两种模式，用户可以通过点击右上角图标在两种模式之间自由切换。

**核心亮点**:
- 🎭 **双模式切换**: 日历网格模式 ⇄ 滚轮选择模式
- 📅 **日历网格模式**: 支持左右滑动切换月份、动态周数显示、年月快速选择器
- 🎡 **滚轮模式**: 年/月/日三列独立滚轮、自动Snap对齐、视觉渐变效果
- 🎯 **智能限制**: 支持设置最小/最大日期范围
- ⚡ **快捷选项**: "今"、"昨"、"前"三个快捷按钮
- 🎨 **像素级定制**: 完全自定义UI，视觉效果精美

### 📂 文件信息

**路径**: `feature/ledger/src/debug/kotlin/com/ccxiaoji/feature/ledger/presentation/demo/stylecatalog/components/CustomDatePickerDialog.kt`

**导入语句**:
```kotlin
import com.ccxiaoji.feature.ledger.presentation.demo.stylecatalog.components.CustomDatePickerDialog
import java.time.LocalDate
```

### 🔧 函数签名

```kotlin
@Composable
fun CustomDatePickerDialog(
    initialDate: LocalDate? = null,      // 初始选中的日期，默认为今天
    minDate: LocalDate? = null,          // 最小可选日期（可选）
    maxDate: LocalDate? = null,          // 最大可选日期（可选）
    onDateSelected: (LocalDate) -> Unit, // 用户选择日期后的回调
    onDismiss: () -> Unit                // 用户取消选择的回调
)
```

### 📋 参数说明

| 参数名 | 类型 | 必需 | 默认值 | 说明 |
|-------|------|------|--------|------|
| `initialDate` | `LocalDate?` | 否 | `null` | 初始显示的日期，为空时默认为今天 |
| `minDate` | `LocalDate?` | 否 | `null` | 最小可选日期，早于此日期的选项会被禁用 |
| `maxDate` | `LocalDate?` | 否 | `null` | 最大可选日期，晚于此日期的选项会被禁用 |
| `onDateSelected` | `(LocalDate) -> Unit` | 是 | - | 用户点击"确定"时触发，返回选中的日期 |
| `onDismiss` | `() -> Unit` | 是 | - | 用户点击"取消"或外部区域时触发 |

### 💡 使用示例

#### 基础用法

```kotlin
@Composable
fun MyScreen() {
    var showDatePicker by remember { mutableStateOf(false) }
    var selectedDate by remember { mutableStateOf<LocalDate?>(null) }

    // 显示选中的日期
    Button(onClick = { showDatePicker = true }) {
        Text(selectedDate?.toString() ?: "选择日期")
    }

    // 日期选择器对话框
    if (showDatePicker) {
        CustomDatePickerDialog(
            initialDate = selectedDate,
            onDateSelected = { date ->
                selectedDate = date
                showDatePicker = false
            },
            onDismiss = { showDatePicker = false }
        )
    }
}
```

#### 高级用法：限制日期范围

```kotlin
@Composable
fun DateRangePickerExample() {
    val today = LocalDate.now()
    val minDate = today.minusMonths(3)  // 最早只能选3个月前
    val maxDate = today.plusMonths(1)   // 最晚只能选1个月后

    var showDatePicker by remember { mutableStateOf(false) }
    var selectedDate by remember { mutableStateOf(today) }

    if (showDatePicker) {
        CustomDatePickerDialog(
            initialDate = selectedDate,
            minDate = minDate,
            maxDate = maxDate,
            onDateSelected = { date ->
                selectedDate = date
                showDatePicker = false
            },
            onDismiss = { showDatePicker = false }
        )
    }
}
```

#### 实际应用：清除账单页面

```kotlin
// 来自 ClearBillsScreen.kt
val startDate = remember { mutableStateOf<LocalDate?>(null) }
val endDate = remember { mutableStateOf<LocalDate?>(null) }
var showStartDatePicker by remember { mutableStateOf(false) }
var showEndDatePicker by remember { mutableStateOf(false) }

// 开始日期选择器
if (showStartDatePicker) {
    CustomDatePickerDialog(
        initialDate = startDate.value,
        onDateSelected = { date ->
            startDate.value = date
            showStartDatePicker = false
        },
        onDismiss = { showStartDatePicker = false }
    )
}

// 截止日期选择器
if (showEndDatePicker) {
    CustomDatePickerDialog(
        initialDate = endDate.value,
        minDate = startDate.value,  // 截止日期不能早于开始日期
        onDateSelected = { date ->
            endDate.value = date
            showEndDatePicker = false
        },
        onDismiss = { showEndDatePicker = false }
    )
}
```

### 🎨 视觉效果

#### 日历网格模式
- **顶部**: 显示"2025年 9月30日 周一" + 切换图标（ViewList）
- **月份导航**: 左右箭头 + 年月下拉选择
- **日历**: 7列（周一~周日）× 动态行数（4-6周）
- **底部**: 快捷按钮（今/昨/前）+ 取消/确定

#### 滚轮模式
- **顶部**: 只显示右上角切换图标（CalendarToday）
- **滚轮**: 三列等宽（年份 | 月份 | 日期）
  - 可见5行，中心项放大高亮（蓝色）
  - 上下项缩小半透明（灰色渐变）
  - 中心分隔线标记选中区域
- **底部**: 快捷按钮（今/昨/前）+ 取消/确定

### ⚠️ 注意事项

1. **依赖库**: 使用 `java.time.LocalDate`，不是 `kotlinx-datetime`
2. **源集限制**: 仅在 `debug` 源集可用，`release` 版本无法使用
3. **模块限制**: 仅在 `feature:ledger` 模块内可用
4. **日期验证**: 组件会自动处理日期有效性（如2月29日、月末等）
5. **性能**: 滚轮模式使用 `LazyColumn` + `graphicsLayer`，性能优秀

### 🔮 已知使用场景

- ✅ **ClearBillsScreen**: 清除账单的开始/结束日期选择
- ⚠️ **AddBillScreen**: 添加账单时的日期选择（可考虑使用）
- ⚠️ **FilterDialog**: 筛选账单的日期范围（可考虑使用）
- ⚠️ **BookReportV2Screen**: 报表的时间范围（可考虑使用）

### 🚀 未来规划

**迁移计划**: 测试完善后，将迁移到 `feature/ledger/src/main/presentation/component/`

**可能的改进**:
- 支持日期范围选择（开始+结束一次选完）
- 添加"本周"、"本月"等更多快捷选项
- 支持自定义颜色主题
- 适配 RTL 布局（从右到左的语言）

---

## 2️⃣ BookSelectionBottomSheet（账本选择）

**状态**: ✅ 已完成
**文件**: `BookSelectionBottomSheet.kt` (9KB)
**功能**: 底部弹出的账本选择器

*（待补充详细文档）*

---

## 3️⃣ NumberKeyboard（数字键盘）

**状态**: ✅ 已完成
**文件**: `NumberKeyboard.kt` (5KB)
**功能**: 自定义数字键盘，用于金额输入

*（待补充详细文档）*

---

## 4️⃣ AddBillTopBar（添加账单顶栏）

**状态**: ✅ 已完成
**文件**: `AddBillTopBar.kt` (4KB)
**功能**: 添加账单页面的顶部工具栏

*（待补充详细文档）*

---

## 5️⃣ AmountInputSection（金额输入区域）

**状态**: ✅ 已完成
**文件**: `AmountInputSection.kt` (4KB)
**功能**: 金额输入和显示组件

*（待补充详细文档）*

---

## 6️⃣ CategoryGrid（分类网格）

**状态**: ✅ 已完成
**文件**: `CategoryGrid.kt` (3KB)
**功能**: 分类选择的网格布局

*（待补充详细文档）*

---

## 7️⃣ CategoryIcons（分类图标）

**状态**: ✅ 已完成
**文件**: `CategoryIcons.kt` (4KB)
**功能**: 分类图标组件

*（待补充详细文档）*

---

## 8️⃣ SvgIconLoader（SVG图标加载器）

**状态**: ✅ 已完成
**文件**: `SvgIconLoader.kt` (5KB)
**功能**: 加载和显示SVG格式的图标

*（待补充详细文档）*

---

## 📚 使用规范

### 导入组件

所有组件的包名都是：
```kotlin
import com.ccxiaoji.feature.ledger.presentation.demo.stylecatalog.components.<组件名>
```

### 命名约定

- **Dialog组件**: 以 `Dialog` 结尾，如 `CustomDatePickerDialog`
- **BottomSheet组件**: 以 `BottomSheet` 结尾，如 `BookSelectionBottomSheet`
- **顶栏组件**: 以 `TopBar` 结尾，如 `AddBillTopBar`
- **输入组件**: 以 `Input` 或 `Keyboard` 结尾，如 `NumberKeyboard`

### 组件复用建议

1. **优先复用**: 开发新页面时，先查看此文档，避免重复开发
2. **保持一致**: 使用相同组件保证UI一致性
3. **及时更新**: 添加新组件后，请更新此文档
4. **提出改进**: 如果组件不满足需求，可以讨论扩展或优化

---

## 🔄 迁移计划

### 阶段1: Demo测试（当前）
- 在 `src/debug` 环境中完善所有组件
- 收集使用反馈，优化交互细节
- 确保所有边界情况都能正常处理

### 阶段2: 准备迁移
- 评估哪些组件适合迁移到正式环境
- 调整依赖库，统一使用正式模块的标准
- 适配主题系统（使用 `DesignTokens` 替代硬编码颜色）

### 阶段3: 正式迁移
- 将组件移至 `src/main/presentation/component/`
- 更新所有引用
- 发布到正式版本，供所有用户使用

---

## 📝 更新日志

| 日期 | 更新内容 | 更新人 |
|------|---------|--------|
| 2025-09-30 | 创建文档，记录 CustomDatePickerDialog | Claude |
| - | - | - |

---

## 📧 联系方式

如有问题或建议，请联系开发团队。