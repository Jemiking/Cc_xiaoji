# CC小记已知问题记录

## 创建信息
- **创建时间**: 2025-06-27
- **最后更新**: 2025-06-27
- **项目状态**: 技术债务健康度79%

## 一、构建环境问题

### 1. Gradle下载超时
- **问题描述**: 执行`./gradlew build`时Gradle wrapper下载超时
- **错误信息**: `Downloading from https://services.gradle.org/distributions/gradle-8.9-bin.zip failed: timeout`
- **影响范围**: 影响本地编译验证
- **解决方案**: 
  - 使用阿里云Maven镜像
  - 手动下载Gradle 8.9并配置本地路径
  - 使用代理或VPN

## 二、技术债务问题

### 1. 版本管理不一致
- **问题描述**: 7个模块仍使用硬编码版本
- **影响模块**: 
  - core/network
  - core/ui
  - shared/backup
  - shared/notification
  - shared/sync
  - shared/user
  - feature/plan
- **影响范围**: 每个模块15-20个依赖，总计约100+个硬编码版本
- **风险等级**: 中等
- **计划修复**: 第1阶段优先修复core模块

### 2. 测试覆盖率不足
- **当前状态**: 25-30%
- **目标**: 45%
- **差距**: 15-20%
- **主要缺失**: 
  - UseCase层测试
  - Repository层测试
  - ViewModel层测试
- **计划修复**: 分阶段提升，第1阶段达到35%

### 3. 代码复杂度过高
- **问题文件**: LedgerViewModel.kt
- **当前行数**: 320行
- **目标行数**: 200行
- **复杂原因**: 
  - 过多的业务逻辑
  - 缺少辅助类抽取
  - 状态管理复杂
- **计划修复**: 第2阶段重构

### 4. 国际化不完整
- **影响模块**: Ledger模块
- **未处理文件**: 41个（已从123个减少到41个）
- **主要是**: ViewModel和UseCase中的硬编码字符串
- **计划修复**: 第2阶段完成

## 三、功能相关问题

### 1. 导航相关TODO
- **影响范围**: Plan和Ledger模块的API实现
- **具体问题**: 
  - navigateToPlanModule()未实现
  - navigateToLedgerModule()未实现
- **原因**: 模块化架构限制，不能直接依赖app模块
- **建议方案**: 使用事件总线或深度链接

### 2. UI组件TODO
- **DatePicker对话框**: 部分实现，缺少年份选择
- **ColorPicker**: Settings中的主题颜色选择未实现
- **分享功能**: Settings中的分享应用功能未实现
- **评分功能**: 跳转应用商店功能未实现

## 四、性能问题

### 1. 编译速度
- **当前**: 约44秒（模块化后已优化）
- **瓶颈**: 
  - KSP处理时间较长
  - 资源处理占用时间
- **优化建议**: 
  - 启用Gradle配置缓存
  - 使用并行编译

### 2. 数据库查询
- **问题**: 部分查询未优化
- **影响**: 
  - Transaction列表加载
  - Statistics计算
- **建议**: 添加适当的索引

## 五、待完善功能

### 1. 自动化相关
- **自动备份**: UI已实现，功能逻辑待完善
- **定时提醒**: Schedule模块的提醒功能需要完善
- **循环任务**: RecurringTransaction的Worker需要测试

### 2. 数据导出
- **CSV导出**: 基础实现，需要格式优化
- **PDF报表**: 未实现
- **数据恢复**: 基础功能实现，需要更多错误处理

## 六、文档缺失

### 1. API文档
- 各模块的公共API缺少详细文档
- 使用示例不足

### 2. 测试文档
- 缺少集成测试指南
- 缺少性能测试基准

### 3. 部署文档
- 缺少生产环境配置指南
- 缺少发布流程文档

## 七、风险评估

### 高风险
1. **版本不一致可能导致依赖冲突**
   - 缓解: 优先修复core模块版本

### 中风险
1. **测试覆盖率低可能遗漏bug**
   - 缓解: 逐步提升测试覆盖率
2. **代码复杂度高增加维护成本**
   - 缓解: 计划性重构

### 低风险
1. **国际化不完整影响用户体验**
   - 缓解: 第2阶段完成
2. **文档缺失影响团队协作**
   - 缓解: 持续补充文档

## 八、下一步行动

### 立即行动（第0阶段）
- [x] 记录已知问题（本文档）
- [x] 备份当前代码状态
- [ ] 配置本地Gradle环境

### 短期计划（第1阶段，1周内）
- [ ] 修复core模块版本管理
- [ ] 提升测试覆盖率到35%
- [ ] 处理高优先级TODO

### 中期计划（第2阶段，2周内）
- [ ] 完成所有模块版本迁移
- [ ] 优化LedgerViewModel
- [ ] 完成国际化

### 长期计划（第3阶段，1个月内）
- [ ] 达到95%技术债务健康度
- [ ] 建立预防机制
- [ ] 完善所有文档

---
*最后更新: 2025-06-27*