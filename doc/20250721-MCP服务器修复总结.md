# MCP服务器连接修复总结

## 问题描述
Android-compiler MCP Server连接失败，状态显示"✘ failed"。

## 根本原因
1. **用户名错误**: 配置中使用了`/home/hua`，但实际WSL用户名是`ua`
2. **WSL调用格式**: 需要使用`wsl -d Ubuntu --`来正确执行命令
3. **nvm环境加载**: 需要使用`bash -l`来确保nvm环境正确加载

## 修复措施

### 1. 创建了新的wrapper脚本
- 文件: `scripts/android-compiler-wrapper-fixed.bat`
- 功能:
  - 确保WSL Ubuntu正在运行
  - 自动转换Windows路径为WSL路径
  - 使用`bash -l`加载nvm环境
  - 正确调用Node.js和android-compiler-mcp

### 2. 更新了MCP配置
- 文件: `.claude/mcp.json`
- 修改: 将android-compiler配置改为使用新的wrapper脚本

### 3. 创建了诊断工具
- `scripts/diagnose-mcp.bat` - 环境诊断脚本
- `scripts/verify-mcp-setup.bat` - 验证安装脚本
- `scripts/android-compiler-wrapper.ps1` - PowerShell备用版本

## 正确的配置信息
- WSL发行版: Ubuntu
- WSL用户名: ua
- Node.js路径: `/home/ua/.nvm/versions/node/v22.17.0/bin/node`
- MCP路径: `/home/ua/android-compiler-mcp/index.js`

## 后续步骤
1. 运行`scripts\verify-mcp-setup.bat`验证配置
2. 重启Claude Code应用新配置
3. MCP服务器应该能够正常连接

## 技术细节
- 使用`bash -l -c`确保nvm环境变量正确加载
- 通过`wsl -d Ubuntu --`指定WSL发行版
- 路径转换将`D:\path`转为`/mnt/d/path`格式

## 文件更改列表
1. ✅ 创建 `scripts/android-compiler-wrapper-fixed.bat`
2. ✅ 创建 `scripts/android-compiler-wrapper.ps1`
3. ✅ 创建 `scripts/diagnose-mcp.bat`
4. ✅ 创建 `scripts/verify-mcp-setup.bat`
5. ✅ 更新 `.claude/mcp.json`
6. ✅ 更新 `scripts/android-compiler-wrapper.bat`
7. ✅ 创建本文档

---
修复时间: 2025-07-21
修复人: Claude Code