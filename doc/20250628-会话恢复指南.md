# 会话恢复指南 - 2025-06-28

## 🎯 当前任务状态

### 正在进行的任务
**技术债务清除第2阶段** - 目标：85%健康度
- ✅ 已完成：Repository测试提升（33-35%覆盖率）
- ✅ 已完成：版本迁移必要性分析（ROI 593%）
- ✅ 已完成：版本迁移执行文档体系（6个文档）
- ⏳ 待执行：版本目录迁移（shared/*和feature/plan模块）

### 待完成的TODO
```
1. 第3阶段：版本目录完全迁移 - 修复shared/*模块 [pending]
2. 第3阶段：版本目录完全迁移 - 修复feature/plan模块 [pending]
```

## 🚀 重启后立即执行

### 1. 验证MCP服务器
```bash
# 检查MCP是否激活
claude mcp list

# 应该看到：
# kotlin-compiler: node /mnt/d/kotlin/mcp-kotlin-compiler/dist/server.js
```

### 2. 测试MCP编译功能
```
# 使用自然语言调用MCP工具
使用MCP工具 check_gradle 检查环境，projectPath是"."

# 或者
使用kotlin-compiler的check_gradle工具，projectPath参数是"."
```

### 3. 开始版本迁移第一个模块
```bash
# 切换到正确分支
git checkout feature/plan-module-migration

# 查看当前状态
git status

# 开始迁移shared-user模块
cat shared/user/build.gradle.kts
```

## 📋 版本迁移快速开始

### 模块迁移顺序
1. **shared-user** ← 从这里开始
2. shared-sync
3. shared-backup
4. shared-notification
5. feature-plan（已部分迁移）

### 每个模块的执行步骤
```bash
# 1. 分析硬编码版本
rg '"[0-9]+\.[0-9]+\.[0-9]+"' shared/user/build.gradle.kts

# 2. 替换版本引用（参考映射表）
# 编辑 shared/user/build.gradle.kts

# 3. 使用MCP验证编译
使用MCP工具 compile_kotlin，projectPath是"."，module是"shared-user"

# 4. 运行验证脚本
./scripts/verify-version-migration.sh shared/user

# 5. 提交更改
git add shared/user/build.gradle.kts
git commit -m "refactor: 迁移shared-user模块到版本目录"
```

## 🔧 MCP工具使用示例

### 环境检查
```
使用kotlin-compiler的check_gradle工具检查环境，projectPath是"."
```

### 编译整个项目
```
使用kotlin-compiler的compile_kotlin工具编译项目，projectPath是"."
```

### 编译特定模块
```
使用kotlin-compiler的compile_kotlin工具编译模块，projectPath是"."，module是"shared-user"
```

### 清理项目
```
使用kotlin-compiler的compile_kotlin工具清理项目，projectPath是"."，task是"clean"
```

## 📚 关键文档位置

### 版本迁移文档
- **执行手册**: `doc/20250628-版本目录迁移执行手册.md`
- **快速检查卡**: `doc/20250628-版本目录迁移快速检查卡.md`
- **完整映射表**: `doc/20250628-版本目录完整映射表.md`
- **防跑偏清单**: `doc/20250628-版本迁移防跑偏检查清单.md`

### 进度报告
- **技术债务路线图**: `doc/20250627-技术债务清除路线图.md`
- **第2阶段进展**: `doc/20250628-技术债务清除第2阶段进展.md`

## ⚡ 快速命令集

```bash
# Git相关
git status
git diff
git log --oneline -5

# 版本检查
rg '"[0-9]+\.[0-9]+\.[0-9]+"' --glob '**/build.gradle.kts'

# 模块列表
ls -la shared/
ls -la feature/

# 验证脚本
chmod +x scripts/verify-version-migration.sh
./scripts/verify-version-migration.sh [module]
```

## 🎯 预期成果

### 本次会话目标
1. ✅ 配置MCP编译服务器
2. ⏳ 迁移5个模块到版本目录
3. ⏳ 达到85%技术债务健康度
4. ⏳ 提交迁移更改

### 成功标准
- 所有模块使用libs.versions.toml
- 0个硬编码版本
- 所有模块编译通过
- 版本保持不变

## 💡 提醒事项

1. **保持专注**：只改版本引用，不改其他
2. **频繁验证**：每个模块都要编译验证
3. **使用MCP**：利用编译工具实时验证
4. **参考文档**：遇到问题查阅映射表

## 🔄 恢复命令

重启Claude后，执行：
```bash
# 1. 查看此文档
cat doc/20250628-会话恢复指南.md

# 2. 继续上次的工作
claude --continue
```

---
*创建时间：2025-06-28*  
*用途：确保会话重启后能继续版本迁移工作*  
*状态：等待MCP激活后开始执行*