# ç‰ˆæœ¬ç›®å½•è¿ç§»æ‰§è¡Œæ‰‹å†Œ

## ğŸ“‹ æ¦‚è¿°
æœ¬æ‰‹å†Œä¸ºç‰ˆæœ¬ç›®å½•è¿ç§»æä¾›ç²¾ç¡®çš„æ‰§è¡ŒæŒ‡å¯¼ï¼Œç¡®ä¿è¿ç§»è¿‡ç¨‹ä¸è·‘åã€ä¸å‡ºé”™ã€å¯è¿½æº¯ã€‚

**æ ¸å¿ƒåŸåˆ™**ï¼šåªæ”¹ç‰ˆæœ¬å¼•ç”¨ï¼Œä¸ç¢°ä¸šåŠ¡é€»è¾‘ã€‚

## ğŸ¯ æˆåŠŸæ ‡å‡†ä¸å¤±è´¥æ ‡å‡†

### âœ… æˆåŠŸæ ‡å‡†
1. **ç‰ˆæœ¬ç®¡ç†**
   - 100%æ¨¡å—ä½¿ç”¨libs.versions.toml
   - 0ä¸ªç¡¬ç¼–ç ç‰ˆæœ¬å·
   - ç‰ˆæœ¬å®šä¹‰é›†ä¸­ç®¡ç†

2. **åŠŸèƒ½å®Œæ•´**
   - æ‰€æœ‰æ¨¡å—ç¼–è¯‘æˆåŠŸ
   - æ‰€æœ‰æµ‹è¯•é€šè¿‡
   - æ„å»ºæ—¶é—´â‰¤25ç§’

3. **ä»£ç è´¨é‡**
   - git diffåªæ˜¾ç¤ºç‰ˆæœ¬å¼•ç”¨å˜åŒ–
   - æ— ä¸šåŠ¡é€»è¾‘æ”¹åŠ¨
   - æ— æ–°å¢ä¾èµ–

### âŒ å¤±è´¥æ ‡å‡†ï¼ˆç«‹å³åœæ­¢ï¼‰
- ä»»ä½•æ¨¡å—ç¼–è¯‘å¤±è´¥
- å¼•å…¥ç‰ˆæœ¬å†²çª
- æ”¹å˜äº†importè¯­å¥ï¼ˆé™¤ç‰ˆæœ¬ç›¸å…³ï¼‰
- ä¿®æ”¹äº†ébuild.gradle.ktsæ–‡ä»¶

## ğŸ“ å‰ç½®å‡†å¤‡æ¸…å•

```bash
# 1. åˆ›å»ºå¤‡ä»½åˆ†æ”¯
git checkout -b backup/before-version-migration
git checkout feature/plan-module-migration

# 2. ç¡®ä¿å¹²å‡€çš„å·¥ä½œåŒº
git status  # åº”æ˜¾ç¤º "working tree clean"

# 3. éªŒè¯å½“å‰ç¼–è¯‘çŠ¶æ€
./gradlew clean build --parallel

# 4. è®°å½•å½“å‰ä¾èµ–ç‰ˆæœ¬
./gradlew dependencies > dependencies-before.txt

# 5. æ£€æŸ¥ç¡¬ç¼–ç ç‰ˆæœ¬åˆ†å¸ƒ
rg -t kotlin '"[0-9]+\.[0-9]+\.[0-9]+"' --glob '**/build.gradle.kts' > hardcoded-versions.txt
```

## ğŸ”„ æ ‡å‡†è¿ç§»æµç¨‹ï¼ˆæ¯ä¸ªæ¨¡å—ï¼‰

### Step 1: è¯»å–å’Œåˆ†æ
```bash
# 1.1 æŸ¥çœ‹å½“å‰build.gradle.kts
cat [module]/build.gradle.kts

# 1.2 è¯†åˆ«æ‰€æœ‰ç¡¬ç¼–ç ç‰ˆæœ¬
rg '"[0-9]+\.[0-9]+\.[0-9]+"' [module]/build.gradle.kts

# 1.3 åˆ—å‡ºæ‰€æœ‰ä¾èµ–
# è®°å½•æ ¼å¼ï¼šä¾èµ–åç§° -> å½“å‰ç‰ˆæœ¬ -> ç›®æ ‡å¼•ç”¨
```

### Step 2: ç‰ˆæœ¬æ˜ å°„è¡¨
åˆ›å»ºæ˜ å°„å…³ç³»ï¼Œç¡®ä¿ç‰ˆæœ¬ä¸€è‡´æ€§ï¼š

| ç¡¬ç¼–ç å€¼ | libs.versions.tomlå¼•ç”¨ | è¯´æ˜ |
|---------|------------------------|------|
| "34" | libs.versions.compileSdk.get().toInt() | Android SDK |
| "26" | libs.versions.minSdk.get().toInt() | æœ€ä½SDK |
| "1.12.0" | libs.androidx.core.ktx | Core KTX |
| "2.7.0" | libs.androidx.lifecycle.* | Lifecycle |
| "2024.02.00" | platform(libs.compose.bom) | Compose BOM |
| "1.5.7" | libs.versions.compose.compiler.get() | Composeç¼–è¯‘å™¨ |

### Step 3: æ‰§è¡Œæ›¿æ¢

#### 3.1 Androidé…ç½®éƒ¨åˆ†
```kotlin
// âŒ é”™è¯¯ï¼ˆç¡¬ç¼–ç ï¼‰
android {
    compileSdk = 34
    
    defaultConfig {
        minSdk = 26
    }
}

// âœ… æ­£ç¡®ï¼ˆç‰ˆæœ¬ç›®å½•ï¼‰
android {
    compileSdk = libs.versions.compileSdk.get().toInt()
    
    defaultConfig {
        minSdk = libs.versions.minSdk.get().toInt()
    }
}
```

#### 3.2 ä¾èµ–éƒ¨åˆ†
```kotlin
// âŒ é”™è¯¯ï¼ˆç¡¬ç¼–ç ï¼‰
dependencies {
    implementation("androidx.core:core-ktx:1.12.0")
    implementation("androidx.lifecycle:lifecycle-runtime-ktx:2.7.0")
}

// âœ… æ­£ç¡®ï¼ˆç‰ˆæœ¬ç›®å½•ï¼‰
dependencies {
    implementation(libs.androidx.core.ktx)
    implementation(libs.androidx.lifecycle.runtime.ktx)
}
```

#### 3.3 ç‰¹æ®Šæƒ…å†µå¤„ç†

**å¹³å°ä¾èµ–ï¼ˆBOMï¼‰**ï¼š
```kotlin
// ä¿æŒplatform()åŒ…è£…
implementation(platform(libs.compose.bom))
```

**ç¼–è¯‘å™¨æ’ä»¶**ï¼š
```kotlin
composeOptions {
    kotlinCompilerExtensionVersion = libs.versions.compose.compiler.get()
}
```

**KSPå‚æ•°**ï¼š
```kotlin
ksp(libs.room.compiler)  // ä¸æ˜¯ implementation
```

### Step 4: éªŒè¯æ£€æŸ¥

#### 4.1 è¯­æ³•éªŒè¯
```bash
# æ£€æŸ¥æ˜¯å¦è¿˜æœ‰ç¡¬ç¼–ç ç‰ˆæœ¬
rg '"[0-9]+\.[0-9]+\.[0-9]+"' [module]/build.gradle.kts

# åº”è¯¥åªå‰©ä¸‹versionCode/versionNameç­‰åº”ç”¨ç‰ˆæœ¬
```

#### 4.2 ç¼–è¯‘éªŒè¯
```bash
# å•æ¨¡å—ç¼–è¯‘
./gradlew :[module]:build

# æ£€æŸ¥ä¾èµ–è§£æ
./gradlew :[module]:dependencies
```

#### 4.3 å·®å¼‚éªŒè¯
```bash
# ç¡®ä¿åªæœ‰ç‰ˆæœ¬å¼•ç”¨å˜åŒ–
git diff [module]/build.gradle.kts

# ä¸åº”è¯¥çœ‹åˆ°ï¼š
# - importè¯­å¥å˜åŒ–
# - é€»è¾‘ä»£ç å˜åŒ–
# - æ–°å¢/åˆ é™¤ä¾èµ–
```

### Step 5: æäº¤è®°å½•
```bash
# æ¯ä¸ªæ¨¡å—ç‹¬ç«‹æäº¤
git add [module]/build.gradle.kts
git commit -m "refactor: è¿ç§»[module]æ¨¡å—åˆ°ç‰ˆæœ¬ç›®å½•

- æ›¿æ¢æ‰€æœ‰ç¡¬ç¼–ç ç‰ˆæœ¬ä¸ºlibs.versions.tomlå¼•ç”¨
- ä¿æŒä¾èµ–ç‰ˆæœ¬ä¸å˜
- ç¼–è¯‘éªŒè¯é€šè¿‡"
```

## ğŸš¨ å¸¸è§é”™è¯¯åŠè§£å†³æ–¹æ¡ˆ

### é”™è¯¯1ï¼šæ‰¾ä¸åˆ°ç‰ˆæœ¬å¼•ç”¨
```
é”™è¯¯ï¼šUnresolved reference: libs
è§£å†³ï¼šç¡®ä¿æ¨¡å—åº”ç”¨äº†ç‰ˆæœ¬ç›®å½•
```

### é”™è¯¯2ï¼šç±»å‹ä¸åŒ¹é…
```
é”™è¯¯ï¼šType mismatch: inferred type is String but Int was expected
è§£å†³ï¼šä½¿ç”¨.toInt()è½¬æ¢
ç¤ºä¾‹ï¼šlibs.versions.compileSdk.get().toInt()
```

### é”™è¯¯3ï¼šé‡å¤ä¾èµ–
```
é”™è¯¯ï¼šDuplicate class found
è§£å†³ï¼šæ£€æŸ¥æ˜¯å¦æ„å¤–æ·»åŠ äº†é‡å¤ä¾èµ–
```

### é”™è¯¯4ï¼šç‰ˆæœ¬å†²çª
```
é”™è¯¯ï¼šConflicting versions
è§£å†³ï¼šç¡®ä¿libs.versions.tomlä¸­ç‰ˆæœ¬ä¸åŸç‰ˆæœ¬ä¸€è‡´
```

## ğŸ“Š è¿ç§»è¿›åº¦è¿½è¸ª

ä½¿ç”¨æ­¤è¡¨æ ¼è¿½è¸ªè¿›åº¦ï¼š

```markdown
| æ¨¡å— | å¼€å§‹æ—¶é—´ | ç¡¬ç¼–ç æ•° | æ›¿æ¢æ•° | ç¼–è¯‘ | æµ‹è¯• | æäº¤ | å®Œæˆæ—¶é—´ |
|------|---------|----------|--------|------|------|------|----------|
| shared-user | - | - | - | - | - | - | - |
| shared-sync | - | - | - | - | - | - | - |
| shared-backup | - | - | - | - | - | - | - |
| shared-notification | - | - | - | - | - | - | - |
| feature-plan | âœ… | 30+ | 30+ | âœ… | âœ… | âœ… | å·²å®Œæˆ |
```

## ğŸ”„ å›æ»šç­–ç•¥

å¦‚æœä»»ä½•æ­¥éª¤å¤±è´¥ï¼š

```bash
# 1. ç«‹å³åœæ­¢
# ä¸è¦å°è¯•"ä¿®å¤"ï¼Œå…ˆå›æ»š

# 2. æ¢å¤æ¨¡å—
git checkout HEAD -- [module]/build.gradle.kts

# 3. åˆ†æå¤±è´¥åŸå› 
# è®°å½•åœ¨æœ¬æ–‡æ¡£çš„"é—®é¢˜è®°å½•"éƒ¨åˆ†

# 4. ä¿®æ­£ç­–ç•¥åé‡è¯•
```

## ğŸ“ æ‰§è¡Œæ£€æŸ¥æ¸…å•ï¼ˆæ¯ä¸ªæ¨¡å—ï¼‰

å¤åˆ¶æ­¤æ¸…å•ï¼Œé€é¡¹å‹¾é€‰ï¼š

```
æ¨¡å—åç§°ï¼š_______________

å‡†å¤‡é˜¶æ®µï¼š
â–¡ å½“å‰åˆ†æ”¯æ­£ç¡®ï¼ˆfeature/plan-module-migrationï¼‰
â–¡ å·¥ä½œåŒºå¹²å‡€ï¼ˆgit statusï¼‰
â–¡ æ¨¡å—å½“å‰ç¼–è¯‘æˆåŠŸ

åˆ†æé˜¶æ®µï¼š
â–¡ è¯»å–build.gradle.kts
â–¡ åˆ—å‡ºæ‰€æœ‰ç¡¬ç¼–ç ç‰ˆæœ¬
â–¡ åˆ›å»ºç‰ˆæœ¬æ˜ å°„è¡¨
â–¡ ç¡®è®¤libs.versions.tomlæœ‰å¯¹åº”æ¡ç›®

æ‰§è¡Œé˜¶æ®µï¼š
â–¡ æ›¿æ¢compileSdk/minSdk/targetSdk
â–¡ æ›¿æ¢composeOptions
â–¡ æ›¿æ¢æ‰€æœ‰implementationä¾èµ–
â–¡ æ›¿æ¢æ‰€æœ‰ksp/kaptä¾èµ–
â–¡ å¤„ç†platformä¾èµ–

éªŒè¯é˜¶æ®µï¼š
â–¡ æ— ç¡¬ç¼–ç ç‰ˆæœ¬é—ç•™ï¼ˆé™¤versionCode/Nameï¼‰
â–¡ æ¨¡å—ç¼–è¯‘æˆåŠŸ
â–¡ ä¾èµ–ç‰ˆæœ¬æœªå˜åŒ–
â–¡ git diffåªæœ‰ç‰ˆæœ¬å¼•ç”¨å˜åŒ–

å®Œæˆé˜¶æ®µï¼š
â–¡ git addåªæ·»åŠ build.gradle.kts
â–¡ commitä¿¡æ¯ç¬¦åˆè§„èŒƒ
â–¡ æ›´æ–°è¿›åº¦è¿½è¸ªè¡¨
```

## ğŸš« ç¦æ­¢äº‹é¡¹

1. **ç¦æ­¢**åŒæ—¶è¿ç§»å¤šä¸ªæ¨¡å—
2. **ç¦æ­¢**ä¿®æ”¹ç‰ˆæœ¬å·ï¼ˆä¿æŒåŸç‰ˆæœ¬ï¼‰
3. **ç¦æ­¢**æ·»åŠ æ–°ä¾èµ–
4. **ç¦æ­¢**åˆ é™¤ç°æœ‰ä¾èµ–
5. **ç¦æ­¢**ä¿®æ”¹ä¾èµ–çš„groupæˆ–artifact
6. **ç¦æ­¢**ä¿®æ”¹build.gradle.ktsä»¥å¤–çš„æ–‡ä»¶

## ğŸ“‹ é—®é¢˜è®°å½•

è®°å½•è¿ç§»è¿‡ç¨‹ä¸­é‡åˆ°çš„é—®é¢˜ï¼š

### é—®é¢˜æ¨¡æ¿
```
æ—¶é—´ï¼šYYYY-MM-DD HH:MM
æ¨¡å—ï¼šmodule-name
é—®é¢˜ï¼šè¯¦ç»†æè¿°
åŸå› ï¼šåˆ†æåŸå› 
è§£å†³ï¼šè§£å†³æ–¹æ¡ˆ
```

## ğŸ¯ æœ€ç»ˆéªŒè¯

æ‰€æœ‰æ¨¡å—å®Œæˆåï¼š

```bash
# 1. å®Œæ•´ç¼–è¯‘
./gradlew clean build --parallel

# 2. è¿è¡Œæ‰€æœ‰æµ‹è¯•
./gradlew test

# 3. æ£€æŸ¥æ— ç¡¬ç¼–ç ç‰ˆæœ¬
rg -t kotlin '"[0-9]+\.[0-9]+\.[0-9]+"' --glob '**/build.gradle.kts' | grep -v "versionCode\|versionName"

# 4. å¯¹æ¯”ä¾èµ–ç‰ˆæœ¬
./gradlew dependencies > dependencies-after.txt
diff dependencies-before.txt dependencies-after.txt
```

## ğŸ“š å‚è€ƒç¤ºä¾‹

### shared-useræ¨¡å—é¢„æœŸæ”¹åŠ¨ç¤ºä¾‹
```kotlin
// Before
implementation("androidx.lifecycle:lifecycle-viewmodel-ktx:2.7.0")
implementation("org.jetbrains.kotlinx:kotlinx-coroutines-android:1.7.3")

// After  
implementation(libs.lifecycle.viewmodel.ktx)
implementation(libs.kotlin.coroutines)
```

---
*æœ¬æ‰‹å†Œåˆ›å»ºäºï¼š2025-06-28*  
*ç”¨é€”ï¼šç¡®ä¿ç‰ˆæœ¬ç›®å½•è¿ç§»ç²¾ç¡®æ‰§è¡Œï¼Œé¿å…è·‘å*  
*ç»´æŠ¤ï¼šæ¯æ¬¡è¿ç§»åæ›´æ–°é—®é¢˜è®°å½•å’Œç»éªŒæ€»ç»“*