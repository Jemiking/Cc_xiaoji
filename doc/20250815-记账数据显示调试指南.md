# 记账数据显示调试指南

## 问题描述
导入钱迹数据后，虽然能看到月度统计（总支出、总收入），但交易列表不显示具体记录。

## 已添加的调试日志

### 1. 日志标签和级别
- **标签**: `LEDGER_DEBUG` 
- **级别**: ERROR（确保显示）
- **过滤**: 在Android Studio的Logcat中搜索 `LEDGER_DEBUG`

### 2. 关键调试点

#### A. LedgerViewModel（主界面ViewModel）
```kotlin
文件: feature/ledger/presentation/viewmodel/LedgerViewModel.kt
日志内容:
- 查询月份和日期范围
- 分页参数（page, size）
- 查询结果数量
- 第一条记录详情
```

#### B. GetPaginatedTransactionsUseCase（业务逻辑层）
```kotlin
文件: feature/ledger/domain/usecase/GetPaginatedTransactionsUseCase.kt
日志内容:
- UseCase层的查询参数
- 返回的记录数和总数
- 时间范围转换
```

#### C. TransactionRepositoryImpl（数据访问层）
```kotlin
文件: feature/ledger/data/repository/TransactionRepositoryImpl.kt
日志内容:
- Repository层的实际查询
- 用户ID验证
- DAO查询结果
- 月度统计查询
```

## 如何查看日志

### 步骤1：编译并运行应用
```bash
# 编译ledger模块
.\gradlew.bat :feature:ledger:compileDebugKotlin

# 或使用快捷脚本
.\compile_ledger.bat
```

### 步骤2：在Android Studio查看日志
1. 打开Logcat窗口
2. 在过滤器中输入: `LEDGER_DEBUG`
3. 选择Error级别（红色）

### 步骤3：执行操作并观察日志
1. 打开记账主界面
2. 切换到2024年10月（或有数据的月份）
3. 观察日志输出，特别注意：
   - 日期范围是否正确
   - 查询返回的记录数
   - 是否有错误信息

## 典型日志示例

### 正常情况
```
E/LEDGER_DEBUG: ========== 加载交易记录 ==========
E/LEDGER_DEBUG: 查询月份: 2024-10
E/LEDGER_DEBUG: 日期范围: 1696089600000 - 1698768000000
E/LEDGER_DEBUG: 时间转换: 开始=Sun Oct 01 00:00:00 CST 2024, 结束=Wed Nov 01 00:00:00 CST 2024
E/LEDGER_DEBUG: ========== UseCase 查询交易记录 ==========
E/LEDGER_DEBUG: ========== Repository 查询交易数据 ==========
E/LEDGER_DEBUG: 当前用户ID: current_user_id
E/LEDGER_DEBUG: DAO查询结果: 100 条记录, 总计 500 条
E/LEDGER_DEBUG: 查询成功: 返回 100 条记录, 总数: 500
```

### 异常情况
```
E/LEDGER_DEBUG: DAO查询结果: 0 条记录, 总计 0 条
E/LEDGER_DEBUG: 警告: DAO返回空列表！
```

## 可能的问题和解决方案

### 问题1：日期范围不匹配
**症状**: 查询的日期范围与数据的实际日期不符
**解决**: 检查日期转换逻辑，确保时区处理正确

### 问题2：用户ID不一致
**症状**: 导入时使用的用户ID与查询时不同
**解决**: 确保使用相同的用户ID（current_user_id）

### 问题3：SQL查询条件问题
**症状**: 查询条件过滤掉了有效数据
**解决**: 检查TransactionDao中的查询条件，特别是：
- `createdAt >= :startDateMillis`
- `createdAt < :endDateMillis` (注意是<而不是<=)

### 问题4：数据转换问题
**症状**: 数据查询成功但转换为Domain模型时失败
**解决**: 检查Entity到Domain的转换逻辑

## 数据库直接调试

如果需要直接查询数据库，可以使用已创建的调试界面：

1. 在导航中添加调试入口
2. 使用 `LedgerDatabaseDebugScreen` 直接查询数据库
3. 可以看到不同查询方法的结果对比

## 下一步行动

根据日志输出，可以判断问题出在哪个层级：
- **ViewModel层**: 查询参数错误
- **Repository层**: 数据库查询问题
- **UI层**: 数据显示问题

请运行应用并提供 `LEDGER_DEBUG` 标签的日志输出，以便进一步分析。