# cn.idev.excel:fastexcel 依赖问题排查指南

## 1. 手动验证步骤

### 1.1 运行网络检查脚本
```bash
# Windows环境
cd scripts
check-maven-dependency.bat

# 或手动执行以下命令
curl -I https://repo1.maven.org/maven2/cn/idev/excel/fastexcel/1.2.0/fastexcel-1.2.0.pom
```

### 1.2 测试独立Gradle项目
```bash
# 进入测试目录
cd test-fastexcel-dep

# 清理并下载依赖
gradle clean build --refresh-dependencies --info

# 检查依赖
gradle checkDependency

# 打印依赖树
gradle dependencies --configuration compileClasspath
```

## 2. 常见问题和解决方案

### 问题1：网络连接问题
**症状**：
- Connection timeout
- TLS handshake failed
- Unable to resolve host

**解决方案**：
```gradle
// 在gradle.properties中添加
systemProp.https.protocols=TLSv1.2,TLSv1.3
systemProp.http.proxyHost=你的代理主机
systemProp.http.proxyPort=你的代理端口
systemProp.https.proxyHost=你的代理主机
systemProp.https.proxyPort=你的代理端口
```

### 问题2：仓库配置问题
**症状**：
- Could not find cn.idev.excel:fastexcel:1.2.0

**解决方案**：
```gradle
// settings.gradle.kts
dependencyResolutionManagement {
    repositoriesMode.set(RepositoriesMode.FAIL_ON_PROJECT_REPOS)
    repositories {
        // 方案1：直接使用Maven Central
        mavenCentral()
        
        // 方案2：使用具体的URL
        maven { 
            url = uri("https://repo1.maven.org/maven2/")
            // 允许不安全的协议（仅用于测试）
            isAllowInsecureProtocol = true
        }
        
        // 方案3：使用阿里云镜像（国内推荐）
        maven { 
            url = uri("https://maven.aliyun.com/repository/central")
            // 设置优先级
            content {
                includeGroup("cn.idev.excel")
            }
        }
        
        google()
    }
}
```

### 问题3：Gradle缓存问题
**症状**：
- 之前的失败尝试被缓存

**解决方案**：
```bash
# 清理Gradle缓存
gradle clean build --refresh-dependencies

# 或删除本地缓存
# Windows
del /s /q %USERPROFILE%\.gradle\caches\modules-2\files-2.1\cn.idev.excel

# 强制重新下载
gradle build --refresh-dependencies --no-build-cache
```

### 问题4：私有仓库或镜像问题
**症状**：
- 公司内网环境无法访问外部仓库

**解决方案**：
1. 配置私有仓库：
```gradle
repositories {
    maven {
        url = uri("http://your-nexus-server/repository/maven-public/")
        credentials {
            username = "your-username"
            password = "your-password"
        }
    }
}
```

2. 手动下载并安装到本地仓库：
```bash
# 下载JAR和POM文件
curl -O https://repo1.maven.org/maven2/cn/idev/excel/fastexcel/1.2.0/fastexcel-1.2.0.jar
curl -O https://repo1.maven.org/maven2/cn/idev/excel/fastexcel/1.2.0/fastexcel-1.2.0.pom

# 安装到本地Maven仓库
mvn install:install-file \
  -Dfile=fastexcel-1.2.0.jar \
  -DpomFile=fastexcel-1.2.0.pom \
  -DgroupId=cn.idev.excel \
  -DartifactId=fastexcel \
  -Dversion=1.2.0 \
  -Dpackaging=jar

# 在build.gradle中添加mavenLocal()
repositories {
    mavenLocal()
    mavenCentral()
}
```

## 3. 验证依赖信息

### 3.1 通过Maven命令验证
```bash
# 搜索依赖
mvn search:search -Dquery="cn.idev.excel"

# 查看依赖详情
mvn dependency:get -Dartifact=cn.idev.excel:fastexcel:1.2.0
```

### 3.2 直接访问验证
浏览器访问以下URL验证文件是否存在：
- POM: https://repo1.maven.org/maven2/cn/idev/excel/fastexcel/1.2.0/fastexcel-1.2.0.pom
- JAR: https://repo1.maven.org/maven2/cn/idev/excel/fastexcel/1.2.0/fastexcel-1.2.0.jar
- SHA1: https://repo1.maven.org/maven2/cn/idev/excel/fastexcel/1.2.0/fastexcel-1.2.0.jar.sha1

## 4. 诊断命令汇总

```bash
# 1. 查看Gradle版本和环境
gradle -v

# 2. 查看所有仓库
gradle tasks --all | grep repositories

# 3. 强制刷新依赖
gradle build --refresh-dependencies --info

# 4. 查看依赖解析详情
gradle dependencies --configuration compileClasspath --info

# 5. 查看依赖解析失败原因
gradle build --stacktrace --debug | grep "cn.idev.excel"

# 6. 检查代理设置
echo %HTTP_PROXY%
echo %HTTPS_PROXY%
```

## 5. 备选方案

如果cn.idev.excel:fastexcel确实无法解析，可以考虑：

1. **使用EasyExcel**（已在项目中实现）
```gradle
implementation("com.alibaba:easyexcel:3.3.4")
```

2. **使用Apache POI**（较重）
```gradle
implementation("org.apache.poi:poi:5.2.4")
implementation("org.apache.poi:poi-ooxml:5.2.4")
```

3. **继续使用org.dhatim:fastexcel**
```gradle
implementation("org.dhatim:fastexcel:0.17.0")
implementation("org.dhatim:fastexcel-reader:0.17.0")
```

## 6. 验证成功标志

依赖解析成功后，你应该看到：
1. BUILD SUCCESSFUL
2. 在依赖树中看到：cn.idev.excel:fastexcel:1.2.0
3. 本地缓存目录出现相关文件：
   - Windows: `%USERPROFILE%\.gradle\caches\modules-2\files-2.1\cn.idev.excel\fastexcel\1.2.0\`

## 7. 联系支持

如果以上方法都无法解决：
1. 检查项目GitHub Issues: https://github.com/fast-excel/fastexcel/issues
2. 提交新Issue描述你的问题
3. 考虑使用备选方案