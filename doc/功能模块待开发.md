# CC小记功能模块待开发清单

> 本文档记录了CC小记应用各模块当前缺失的功能，用于指导后续开发工作。

## 🚨 紧急修复项（2025-06-06）

### 分类系统迁移问题
- **问题**：添加交易时应用闪退
- **原因**：新旧分类系统不兼容，`category` 字段为 null 导致 `CategoryTotal` 构造函数报错
- **状态**：已定位问题，待修复
- **修复方案**：见 [分类系统修复快速清单](./分类系统修复快速清单.md) 和 [分类系统迁移修复指南](./分类系统迁移修复指南.md)

## 📊 记账模块（Ledger）

### 已实现功能
- ✅ 基础交易记录（增删改查）
- ✅ 收支分类管理
- ✅ 月度概览和汇总
- ✅ 多账户支持
- ✅ 预算提醒
- ✅ 交易搜索和筛选
- ✅ 日期范围筛选
- ✅ 分类统计
- ✅ 交易分组展示
- ✅ 批量选择删除
- ✅ 交易复制功能
- ✅ 月份选择导航
- ✅ 周期性交易管理界面（2025-05-29 完成）
- ✅ 周期性交易Worker（2025-05-29 完成）
- ✅ 收支趋势折线图（2025-05-29 完成）
- ✅ 分类占比饼图（2025-05-29 完成）
- ✅ 收支排行柱状图（2025-05-29 完成）

### 核心功能待开发

#### 1. 周期性交易管理
- [x] 定期账单自动记录 ✅ RecurringTransactionWorker实现
- [x] 固定收支管理界面 ✅ RecurringTransactionScreen实现  
- [△] 周期性交易提醒（Worker已实现，通知功能待完善）
- [x] 自动生成周期交易 ✅ Worker定期执行

#### 2. 高级记账功能
- [ ] 多币种支持与汇率转换
- [ ] 账单拆分功能
- [ ] 借贷/欠款管理
- [ ] 投资记录跟踪
- [ ] 报销管理系统
- [ ] 预付款项管理

#### 3. 智能功能
- [ ] 收据拍照识别（OCR）
- [ ] 语音记账
- [ ] 智能分类建议
- [ ] 支出预测分析
- [ ] 异常支出提醒
- [ ] 消费习惯分析

#### 4. 可视化报表
- [x] 收支趋势折线图 ✅ StatisticsScreen实现
- [x] 分类占比饼图 ✅ StatisticsScreen实现
- [ ] 年度对比分析
- [ ] 自定义报表生成
- [ ] 现金流量表
- [ ] 资产负债表

#### 5. 其他功能
- [ ] 账单标签系统
- [ ] 商家/收款方管理
- [ ] 位置信息记录
- [ ] 交易附件（图片、文件）
- [ ] 交易备注模板
- [ ] 快速记账入口

## ✅ 待办模块（Todo）

### 已实现功能
- ✅ 任务创建和删除
- ✅ 任务编辑功能（2025-01-29 新增）
- ✅ 任务搜索功能（2025-01-29 新增）
- ✅ 任务筛选器（按状态、优先级、日期）（2025-01-29 新增）
- ✅ 任务优先级设置
- ✅ 截止日期设置
- ✅ 任务描述
- ✅ 完成状态切换
- ✅ 简单任务列表展示
- ✅ 任务到期提醒（2025-05-29 完成）

### 基础功能待开发

#### 1. 任务管理
- [x] **任务编辑功能**（当前只能创建和删除）✅ 2025-01-29 完成
- [x] 任务搜索功能 ✅ 2025-01-29 完成
- [x] 任务筛选器（按状态、优先级、日期）✅ 2025-05-29 完成
- [ ] 任务排序选项
- [ ] 任务归档功能

#### 2. 任务组织
- [ ] 项目/分类管理
- [ ] 子任务和检查清单
- [ ] 标签系统
- [ ] 文件夹组织结构
- [ ] 任务分组展示

#### 3. 提醒和通知
- [△] 定时提醒设置（基础功能已实现，待完善）
- [ ] 位置提醒
- [ ] 重复任务设置
- [x] 提前提醒选项 ✅ 任务到期前30分钟提醒
- [ ] 智能提醒建议

#### 4. 视图模式
- [ ] 日历视图
- [ ] 看板视图（拖拽支持）
- [ ] 甘特图视图
- [ ] 时间线视图
- [ ] 列表分组视图

#### 5. 协作功能
- [ ] 任务分配
- [ ] 评论系统
- [ ] 共享清单
- [ ] 任务进度更新
- [ ] @提及功能

#### 6. 高级功能
- [ ] 任务模板库
- [ ] 批量操作工具
- [ ] 任务依赖关系
- [ ] 时间跟踪统计
- [ ] 番茄工作法计时器
- [ ] 任务导入导出
- [ ] 与日历应用集成

## 🎯 习惯模块（Habit）

### 已实现功能
- ✅ 习惯创建和删除
- ✅ 习惯编辑功能（2025-01-29 新增）
- ✅ 习惯搜索功能（2025-05-29 新增）
- ✅ 每日/每周/每月周期设置
- ✅ 连续天数追踪
- ✅ 打卡功能
- ✅ 目标次数设置
- ✅ 习惯列表展示
- ✅ 习惯打卡提醒（2025-05-29 完成）
- ✅ 习惯统计视图切换（2025-05-29 完成）

### 基础功能待开发

#### 1. 习惯管理
- [x] **习惯编辑功能**（当前只能创建和删除）✅ 2025-01-29 完成
- [ ] 习惯分类管理
- [x] 习惯搜索功能 ✅ 2025-05-29 完成
- [ ] 习惯排序和筛选
- [ ] 习惯暂停/恢复

#### 2. 数据追踪
- [△] 完成率统计图表（组件已创建，数据获取待完善）
- [△] 趋势分析（周/月/年）（图表组件已创建，数据获取待完善）
- [x] 最佳连续记录保存 ✅ HabitWithStreak包含longestStreak
- [ ] 月度/年度报告生成
- [ ] 打卡时间记录

#### 3. 灵活性设置
- [ ] 自定义频率（如每周3次）
- [ ] 弹性打卡时间窗口
- [ ] 休息日/假期设置
- [ ] 补打卡功能
- [ ] 多次打卡支持

#### 4. 激励系统
- [ ] 成就徽章系统
- [ ] 里程碑奖励
- [ ] 积分/等级系统
- [ ] 习惯排行榜
- [ ] 激励语录展示
- [ ] 打卡分享功能

#### 5. 可视化展示
- [△] 日历热力图（HabitCalendarHeatmap组件已创建，数据获取待完善）
- [ ] 习惯链条展示
- [x] 进度环形图 ✅ HabitCompletionRateChart实现
- [ ] 对比分析图表
- [ ] 习惯完成度矩阵

#### 6. 其他功能
- [ ] 习惯模板库
- [x] 习惯提醒通知 ✅ NotificationScheduler实现每日定时提醒
- [ ] 打卡备注功能
- [x] 习惯数据导出 ✅ DataExportViewModel支持习惯数据导出
- [ ] 坏习惯戒除追踪
- [ ] 习惯组/习惯包

## 👤 个人中心模块（Profile）

### 已实现功能
- ✅ 用户信息展示
- ✅ 模块设置入口
- ✅ 数据管理入口
- ✅ 应用设置入口
- ✅ 退出登录功能
- ✅ 同步功能按钮（2025-05-29 完成）
- ✅ 上次同步时间显示（2025-05-29 完成）

### 账户功能待开发

#### 1. 个人资料
- [ ] 头像上传和编辑
- [ ] 昵称修改
- [ ] 个性签名设置
- [ ] 个人统计仪表盘
- [ ] 使用时长统计

#### 2. 账户安全
- [ ] 密码修改功能
- [ ] 双因素认证
- [ ] 登录设备管理
- [ ] 安全操作日志
- [ ] 异常登录提醒

### 设置功能待开发（当前多为占位符）

#### 1. 应用设置
- [x] 主题切换实现（深色/浅色/自动）✅ ThemeSettingsScreen完成
- [ ] 语言切换实现
- [ ] 字体大小调节
- [x] 通知详细设置 ✅ NotificationSettingsScreen完成
- [ ] 默认页面设置
- [ ] 手势操作设置

#### 2. 数据管理
- [△] 数据导出功能实现（JSON/CSV已实现，Excel待实现）
- [ ] 批量操作功能实现
- [ ] 存储空间管理
- [ ] 数据清理工具
- [ ] 自动备份设置
- [ ] 数据恢复向导

#### 3. 隐私设置
- [ ] 应用锁实现
- [ ] 指纹/面部解锁
- [ ] 隐私模式
- [ ] 数据加密选项
- [ ] 隐私数据清除

#### 4. 其他设置
- [ ] 帮助中心内容
- [ ] 意见反馈功能
- [ ] 版本更新检测
- [ ] 用户协议/隐私政策
- [ ] 第三方账号绑定

## 🔄 跨模块通用功能待开发

### 1. 同步功能
- [x] 云端同步实现（API框架已存在）✅ SyncWorker完整实现
- [x] 离线模式优化 ✅ 支持离线使用和在线同步
- [x] 冲突解决机制 ✅ 最后写入优先策略
- [ ] 多设备同步
- [ ] 增量同步优化
- [x] 同步状态显示 ✅ ProfileScreen显示同步状态

### 2. 搜索功能
- [ ] 全局搜索功能
- [△] 高级筛选器（待办和习惯模块已实现）
- [ ] 搜索历史记录
- [ ] 搜索结果高亮

### 3. 通知系统
- [△] 本地通知实现（框架完成，预算检查逻辑待实现）
- [ ] 推送通知集成
- [ ] 通知中心
- [x] 通知分类管理 ✅ NotificationSettingsScreen分模块管理
- [x] 静默时段设置 ✅ 免打扰时段配置
- [ ] 通知音效自定义

### 4. 小部件
- [ ] 桌面小部件完善
- [ ] 快捷方式支持
- [ ] 悬浮窗功能
- [ ] 负一屏卡片
- [ ] 锁屏组件

## 🛠️ 技术优化事项

### 1. 代码质量
- [ ] 完善错误处理机制
- [ ] 添加单元测试
- [ ] 添加集成测试
- [ ] 完善代码文档
- [ ] 代码规范检查
- [ ] 持续集成配置

### 2. 性能优化
- [ ] 大数据量处理优化
- [ ] 图片压缩和缓存
- [ ] 数据库查询优化
- [ ] 内存管理优化
- [ ] 启动速度优化
- [ ] 列表滚动优化

### 3. 用户体验
- [ ] 添加动画效果
- [ ] 页面过渡动画
- [ ] 加载状态优化
- [ ] 空状态设计
- [ ] 错误提示优化
- [ ] 操作反馈增强

### 4. 安全性
- [ ] 数据加密存储
- [ ] 网络请求加密
- [ ] 敏感信息保护
- [ ] 代码混淆
- [ ] 防截屏功能
- [ ] 安全审计日志

## 开发优先级建议

### 第一阶段（基础功能完善）
1. 各模块的编辑功能实现 ✅
2. 搜索和筛选功能 ✅
3. 基础数据统计展示 ✅ 2025-05-29 完成
   - 修复习惯今日打卡数统计
   - 新增账户总余额显示
4. 本地通知功能 ✅ 2025-05-29 完成
   - 实现任务到期提醒
   - 实现习惯打卡提醒
   - 实现预算超支提醒
   - 集成WorkManager定时调度

### 第二阶段（核心功能扩展）
1. 数据可视化图表 ✅ 2025-05-29 完成
   - 统计页面集成图表（折线图、饼图、柱状图）
   - 习惯模块添加完成率统计、趋势图、热力图
   - 创建专门的习惯图表组件HabitChart.kt
2. 云同步功能实现 ✅ 2025-05-29 完成
   - 完善SyncWorker实现所有实体的同步
   - 添加冲突解决机制
   - 集成到个人中心界面
   - 启动定期同步任务
3. 数据导入导出 ✅ 2025-05-29 完成
   - 实现数据导出界面DataExportScreen
   - 支持JSON/CSV/Excel格式选择
   - 模块化导出（记账/待办/习惯/其他）
   - 文件分享功能
   - 导出历史记录
4. 高级设置实现 ✅ 2025-05-29 完成
   - 主题切换界面（深色/浅色/跟随系统）
   - 主题颜色选择
   - 通知设置详细管理
   - 任务/习惯/预算提醒配置

### 第三阶段（体验优化）
1. UI动画和交互优化
2. 智能化功能
3. 小部件开发
4. 性能优化

### 第四阶段（高级功能）
1. 高级数据分析
2. 第三方集成


## 第一阶段开发总结（2025-05-29）

### 已完成功能

#### 1. 待办模块（Todo）
- ✅ 任务编辑功能 - 支持修改任务标题、描述、优先级和截止日期
- ✅ 任务搜索功能 - 支持按标题和描述搜索任务
- ✅ 任务筛选器 - 支持按状态、优先级、日期（今天/本周/逾期）筛选

#### 2. 习惯模块（Habit）  
- ✅ 习惯编辑功能 - 支持修改习惯名称、描述、周期和目标
- ✅ 习惯搜索功能 - 支持按名称和描述搜索习惯

#### 3. 基础数据统计展示
- ✅ 修复习惯今日打卡数统计（原本硬编码为0）
- ✅ 新增账户总余额显示在主页概览卡片

#### 4. 本地通知功能
- ✅ 任务到期提醒 - 任务到期前30分钟自动提醒
- ✅ 习惯打卡提醒 - 支持设置每日定时提醒
- ✅ 预算超支提醒 - 预算使用超过设定阈值时提醒
- ✅ 集成WorkManager实现后台定时调度

### 技术实现亮点
1. 使用Kotlin Flow实现响应式数据流
2. 采用Repository模式实现数据层与UI层解耦
3. 使用WorkManager确保通知在应用关闭时也能正常工作
4. 实现了完整的增删改查和同步状态跟踪

### 下一阶段规划
根据文档，第二阶段将重点实现：
1. 数据可视化图表
2. 云同步功能实现
3. 数据导入导出
4. 高级设置实现

## 第二阶段开发进展（2025-05-29）

### 已完成功能 - 数据可视化图表

#### 1. 统计页面图表集成
- ✅ 收支趋势折线图 - 显示每日收入支出变化
- ✅ 分类占比饼图 - 展示收支分类占比
- ✅ 收支排行柱状图 - 显示TOP5收入和支出

#### 2. 习惯模块统计功能
- ✅ 习惯完成率统计组件
  - 总体完成率卡片
  - 各习惯完成进度条
  - 当前连续天数和最长连续记录
- ✅ 习惯趋势图 - 展示完成率变化趋势
- ✅ 习惯热力图 - 日历形式展示打卡情况
- ✅ 视图切换功能 - 列表视图和统计视图切换

#### 3. 技术实现
- 使用Compose Canvas API原生绘制图表
- 创建独立的图表组件：BarChart、LineChart、PieChart、HabitChart
- 更新HabitWithStreak数据结构，添加completedCount和longestStreak
- 优化HabitRepository计算逻辑

### 下一步计划
继续第二阶段剩余功能：
1. 云同步功能实现
2. 数据导入导出
3. 高级设置实现

## 第二阶段开发总结（2025-05-29）

### 已完成功能

#### 1. 云同步功能
- ✅ 完善SyncWorker实现
  - 实现所有实体的上传和下载同步
  - 添加getByIdSync方法到所有DAO
  - 处理数据冲突（最后写入优先策略）
  - 错误处理和重试机制
- ✅ 同步管理
  - SyncManager定期同步调度
  - 同步状态跟踪
  - 集成到MainActivity自动启动
- ✅ UI集成
  - 个人中心添加同步按钮
  - 显示上次同步时间
  - 同步进度状态显示

#### 2. 数据导入导出
- ✅ 导出功能实现
  - 创建DataExportScreen界面
  - 支持JSON/CSV/Excel格式选择
  - 按模块选择导出内容
  - 日期范围筛选
- ✅ 文件管理
  - FileProvider配置支持文件分享
  - 导出历史记录保存
  - 文件大小显示
- ✅ ViewModel实现
  - DataExportViewModel处理导出逻辑
  - 格式转换处理
  - 文件分享功能

### 技术要点
1. 使用WorkManager实现后台同步
2. Gson序列化处理数据导出
3. FileProvider安全分享文件
4. 冲突解决策略设计

### 待改进项
1. Excel导出需要引入Apache POI库
2. CSV导出需要完善字段映射
3. 数据导入功能待实现
4. 同步冲突的用户界面提示

#### 3. 高级设置功能
- ✅ 主题设置
  - 创建ThemeSettingsScreen界面
  - 支持深色/浅色/跟随系统模式
  - 主题颜色选择（6种预设颜色）
  - 动态主题支持（Android 12+）
- ✅ 通知设置
  - 创建NotificationSettingsScreen界面
  - 分模块管理通知（任务/习惯/预算）
  - 提醒时间和阈值配置
  - 免打扰时段设置
  - 震动和声音控制

### 第二阶段完成总结
本阶段成功实现了所有规划的功能：
1. **数据可视化** - 集成多种图表组件，提升数据展示效果
2. **云同步** - 完整的同步机制，支持离线使用和在线同步
3. **数据导出** - 灵活的导出选项，方便数据备份和分享
4. **高级设置** - 个性化配置，提升用户体验

---

*最后更新时间：2025-05-29*（功能状态同步更新）