# 记账模块完整页面清单

> **生成时间**：2025-11-07
> **数据库版本**：v23（增强通知和提醒系统）
> **模块健康度**：约82%，持续优化中

根据对代码库的全面探索，记账模块包含**55+个正式页面**和**20+个Demo页面**，是项目中最复杂的功能模块。

---

## 一、核心功能页面（正式环境）

### 📊 1. 交易记录管理（7个页面）

| 页面名称 | 文件路径 | 核心功能 |
|---------|---------|---------|
| **LedgerScreen** | `screen/ledger/LedgerScreen.kt` | 记账主页面，显示交易列表、月份筛选、账户过滤、收支统计 |
| **AddTransactionScreen** | `screen/transaction/AddTransactionScreen.kt` | 新增/编辑交易，支持分类、金额、账户、日期、位置、备注输入 |
| **EditTransactionScreen** | `screen/transaction/EditTransactionScreen.kt` | 编辑已有交易记录 |
| **TransactionDetailScreen** | `screen/transaction/TransactionDetailScreen.kt` | 查看交易完整详情 |
| **DeleteTransactionScreen** | `screen/transaction/delete/DeleteTransactionScreen.kt` | 删除交易确认对话框 |
| **FilterTransactionScreen** | `screen/transaction/FilterTransactionScreen.kt` | 交易筛选（按账户、分类、日期、金额等） |
| **AdvancedFilterScreen** | `screen/AdvancedFilterScreen.kt` | 高级筛选功能（多条件组合） |

**作用**：提供完整的交易记录生命周期管理，从创建、查看、编辑到删除的全流程支持。

---

### 💰 2. 账户与资产管理（6个页面）

| 页面名称 | 文件路径 | 核心功能 |
|---------|---------|---------|
| **UnifiedAccountAssetScreen** ⭐ | `screen/account/UnifiedAccountAssetScreen.kt` | 统一的账户资产仪表板（Tab设计），整合资产总览和账户管理 |
| **AssetOverviewScreen** | `screen/AssetOverviewScreen.kt` | 资产总览：净资产、资产分布、趋势分析 |
| **AccountScreen** | `screen/account/AccountScreen.kt` | 账户列表管理，按类型分组显示 |
| **AddAccountScreen** | `screen/account/AddAccountScreen.kt` | 新增账户（储蓄卡、信用卡、现金等） |
| **EditAccountScreen** | `screen/account/EditAccountScreen.kt` | 编辑账户信息（名称、余额、图标等） |
| **TransferScreen** | `screen/account/TransferScreen.kt` | 账户间转账功能，自动创建关联交易记录 |

**作用**：提供一站式账户资产管理体验，用户无需在多个页面间跳转即可完成资产查看和账户操作。

**关键设计**：
- **UnifiedAccountAssetScreen** 采用 HorizontalPager + Tab 设计
- 资产总览和账户管理在同一页面，提升操作效率
- 支持多账户余额统计和可视化图表展示

---

### 🏷️ 3. 分类管理（3个页面）

| 页面名称 | 文件路径 | 核心功能 |
|---------|---------|---------|
| **CategoryManagementScreen** | `screen/category/CategoryManagementScreen.kt` | 分类管理，支持二级分类结构（父分类-子分类） |
| **AddCategoryScreen** | `screen/category/AddCategoryScreen.kt` | 新增分类，区分收入/支出类型 |
| **EditCategoryScreen** | `screen/category/EditCategoryScreen.kt` | 编辑分类信息（名称、图标、类型） |

**作用**：管理交易分类体系，支持80+个预设分类和用户自定义分类。

**技术特性**：
- 二级分类系统（v9数据库升级）
- 智能分类缓存机制（提升性能）
- 支持钱迹应用数据智能映射

---

### 💳 4. 信用卡管理（7个页面）

| 页面名称 | 文件路径 | 核心功能 |
|---------|---------|---------|
| **CreditCardDetailScreen** | `screen/creditcard/CreditCardDetailScreen.kt` | 信用卡详情（额度、已用额度、还款日） |
| **CreditCardBillsScreen** | `screen/creditcard/CreditCardBillsScreen.kt` | 信用卡账单列表 |
| **CreditCardBillDetailScreen** | `screen/creditcard/CreditCardBillDetailScreen.kt` | 单个账单详情 |
| **PaymentScreen** | `screen/creditcard/PaymentScreen.kt` | 还款操作界面 |
| **PaymentHistoryScreen** | `screen/creditcard/PaymentHistoryScreen.kt` | 还款历史记录 |
| **CreditCardSettingsScreen** | `screen/creditcard/CreditCardSettingsScreen.kt` | 信用卡设置（还款提醒等） |
| **EditCreditCardScreen** | `screen/creditcard/EditCreditCardScreen.kt` | 编辑信用卡信息 |

**作用**：完整的信用卡生命周期管理，从账单跟踪到还款提醒的全流程支持。

---

### 🏦 5. 银行卡管理（2个页面）

| 页面名称 | 文件路径 | 核心功能 |
|---------|---------|---------|
| **CardManagementScreen** | `screen/card/CardManagementScreen.kt` | 银行卡列表管理（v17新增cards表） |
| **AddEditCardScreen** | `screen/card/AddEditCardScreen.kt` | 新增/编辑银行卡（持卡人、发卡机构等v18字段） |

**作用**：管理多种卡片类型（借记卡、信用卡、储蓄卡），存储完整的卡片信息。

---

### 📈 6. 预算管理（2个页面）

| 页面名称 | 文件路径 | 核心功能 |
|---------|---------|---------|
| **BudgetScreen** | `screen/budget/BudgetScreen.kt` | 预算列表和总体预算展示 |
| **AddEditBudgetScreen** | `screen/budget/AddEditBudgetScreen.kt` | 新增/编辑预算（关联分类、设置金额） |

**作用**：设置月度预算，跟踪消费进度，避免超支。支持预算超支通知提醒（通过notification模块）。

---

### 🎯 7. 储蓄目标（5个页面）

| 页面名称 | 文件路径 | 核心功能 |
|---------|---------|---------|
| **SavingsGoalScreen** | `screen/savings/SavingsGoalScreen.kt` | 储蓄目标列表 |
| **AddEditSavingsGoalScreen** | `screen/savings/AddEditSavingsGoalScreen.kt` | 新增/编辑储蓄目标 |
| **SavingsGoalDetailScreen** | `screen/savings/SavingsGoalDetailScreen.kt` | 储蓄目标详情（进度、历史） |
| **ContributionScreen** | `screen/savings/ContributionScreen.kt` | 向目标充值/贡献 |
| **DeleteGoalScreen** | `screen/savings/DeleteGoalScreen.kt` | 删除目标确认 |

**作用**：帮助用户设定储蓄目标（如买车、旅游），追踪储蓄进度，建立长期理财习惯。

---

### 🔄 8. 定期交易（2个页面）

| 页面名称 | 文件路径 | 核心功能 |
|---------|---------|---------|
| **RecurringTransactionScreen** | `screen/recurring/RecurringTransactionScreen.kt` | 定期交易列表（房租、订阅等） |
| **AddEditRecurringTransactionScreen** | `screen/recurring/AddEditRecurringTransactionScreen.kt` | 新增/编辑定期交易规则 |

**作用**：自动化重复性交易记录，减少手动记账负担。

---

### 📊 9. 统计分析（1个页面）

| 页面名称 | 文件路径 | 核心功能 |
|---------|---------|---------|
| **StatisticsScreen** | `screen/statistics/StatisticsScreen.kt` | 统计分析页面，包含柱状图、折线图、饼图等多种图表展示 |

**作用**：可视化财务数据，提供按分类、时间段的深度分析，帮助用户洞察消费习惯。

**图表类型**：
- BarChart（柱状图）：月度/年度收支对比
- LineChart（折线图）：收支趋势变化
- PieChart（饼图）：分类支出占比

---

### 📖 10. 记账簿管理（1个页面）

| 页面名称 | 文件路径 | 核心功能 |
|---------|---------|---------|
| **LedgerBookManagementScreen** | `screen/ledgerbook/LedgerBookManagementScreen.kt` | 多记账簿管理（v11新增），支持创建/编辑/删除/设置默认 |

**作用**：实现多账本独立记账（如"个人账本"、"家庭账本"、"公司账本"），数据隔离互不影响。

---

### ⚡ 11. 批量操作（3个页面）

| 页面名称 | 文件路径 | 核心功能 |
|---------|---------|---------|
| **BatchDeleteScreen** | `screen/batch/BatchDeleteScreen.kt` | 批量删除交易记录 |
| **BatchUpdateAccountScreen** | `screen/batch/BatchUpdateAccountScreen.kt` | 批量更新账户归属 |
| **BatchUpdateCategoryScreen** | `screen/batch/BatchUpdateCategoryScreen.kt` | 批量更新交易分类 |

**作用**：提高数据管理效率，一次性操作多条记录。

---

### 📥📤 12. 导入导出（2个页面）

| 页面名称 | 文件路径 | 核心功能 |
|---------|---------|---------|
| **LedgerImportScreen** | `screen/import/LedgerImportScreen.kt` | CSV数据导入，支持9种数据类型 |
| **QianjiImportScreen** | `screen/import/QianjiImportScreen.kt` | 钱迹应用数据导入，智能映射到二级分类 |

**作用**：数据迁移和备份，支持冲突解决（Skip/Merge/Rename/Overwrite），保障数据安全。

**关键修复**（2025-08-15）：
- 文件选择器兼容性优化（GetContent → OpenDocument）
- 数据映射问题修复（Skip保留实体引用）

---

### ⚙️ 13. 设置配置（7个页面）

| 页面名称 | 文件路径 | 核心功能 |
|---------|---------|---------|
| **LedgerSettingsScreen** | `screen/settings/LedgerSettingsScreen.kt` | 记账设置主页面，导航到各子设置 |
| **AccountSelectionScreen** | `screen/settings/AccountSelectionScreen.kt` | 默认账户选择 |
| **CurrencySelectionScreen** | `screen/settings/CurrencySelectionScreen.kt` | 币种选择（CNY、USD等） |
| **HomeDisplaySettingsScreen** | `screen/settings/HomeDisplaySettingsScreen.kt` | 首页显示设置（显示内容、排序） |
| **LedgerUIStyleScreen** | `screen/settings/LedgerUIStyleScreen.kt` | UI风格设置（BALANCED平衡/HIERARCHICAL层级） |
| **ReminderSettingsScreen** | `screen/settings/ReminderSettingsScreen.kt` | 提醒设置（任务、习惯、预算、信用卡提醒） |
| **PermissionGuideScreen** | `screen/settings/PermissionGuideScreen.kt` | 权限设置引导（通知、存储等） |

**作用**：个性化配置，提升用户体验。

---

### 🤖 14. 自动记账（3个页面）

| 页面名称 | 文件路径 | 核心功能 |
|---------|---------|---------|
| **AutoLedgerSettingsScreen** | `screen/settings/AutoLedgerSettingsScreen.kt` | 自动记账总开关和规则配置 |
| **AutoLedgerDeveloperSettingsScreen** | `screen/settings/AutoLedgerDeveloperSettingsScreen.kt` | 开发者自动记账设置（Debug版本专用） |
| **AutoLedgerDebugScreen** | `screen/debug/AutoLedgerDebugScreen.kt` | 自动记账调试面板，查看解析日志 |

**作用**：监听支付宝/微信支付通知，自动解析交易信息并弹窗确认记账，减少手动输入。

**技术架构**：
- PaymentNotificationListener（通知监听服务）
- AlipayNotificationParser（通知解析器）
- AutoLedgerManager（自动记账管理器）
- 完整的事件流和调试记录系统

**关键修复**（2025-08-25）：
- 修复导航链路断裂问题（4级链路完整修复）
- 添加PermissionGuideRoute路由定义

---

## 二、Demo演示页面（Debug环境）

### 🎨 Demo主入口

**StyleCatalogDemoActivity** - Demo环境总入口（仅Debug版本可见）

### 主要Demo页面（20+个）

| 页面名称 | 文件名 | 演示内容 |
|---------|--------|---------|
| **ExpenseTrackerPreviewScreen** | `ExpenseTrackerPreview.kt` | Demo主预览页面 |
| **AddBillScreen** | `AddBillScreen.kt` | 记账界面V1（原始设计） |
| **AddBillScreenV2** ⭐ | `AddBillScreenV2.kt` | 记账界面V2（iOS风格1:1复刻）- 持续演进中 |
| **AssetPageScreen** | `AssetPageScreen.kt` | 资产页面Demo（2025-10-05新增） |
| **BookReportV2Screen** | `BookReportV2Screen.kt` | 记账报表V2 Demo |
| **BooksScreen** | `BooksScreen.kt` | 记账簿列表Demo |
| **CategoryManagementScreen** | `CategoryManagementScreen.kt` | 分类管理Demo |
| **InstallmentsScreen** | `InstallmentsScreen.kt` | 分期计划Demo |
| **CardBackupScreen** | `CardBackupScreen.kt` | 卡片备份V1 |
| **CardBackupScreenNew** | `CardBackupScreenNew.kt` | 卡片备份新版本 |
| **DemoSettingsAboutScreen** | `DemoSettingsAboutScreen.kt` | 关于与设置Demo |

**其他Demo组件**：
- CategoryDonutCard（分类甜甜圈图表）
- DailyBarChartCard（日度柱状图）
- DailyTableCard（日度表格）
- FilterDialog（筛选对话框）
- OverviewCard（概览卡片）

**Demo路由**：定义在`DemoNavigation.kt`和`DemoRoutes.kt`

---

### 📦 可复用组件库（Demo环境）

位置：`demo/stylecatalog/components/`

| 组件名 | 文件 | 用途 |
|--------|------|------|
| **CustomDatePickerDialog** ⭐ | `CustomDatePickerDialog.kt` | 自定义日期选择器（已文档化） |
| **BookSelectionBottomSheet** | `BookSelectionBottomSheet.kt` | 记账簿选择底部弹窗 |
| **CategoryGrid** | `CategoryGrid.kt` | 分类网格展示 |
| **NumberKeyboard** | `NumberKeyboard.kt` | 数字键盘 |
| **AmountInputSection** | `AmountInputSection.kt` | 金额输入区域 |
| **AddBillTopBar** | `AddBillTopBar.kt` | 记账顶部栏 |
| **CategoryIconProvider** | `CategoryIconProvider.kt` | 分类图标提供者 |
| **SvgIconLoader** | `SvgIconLoader.kt` | SVG图标加载器 |

**文档维护规则**：
- ⭐ 所有可复用组件必须记录到 `doc/demo开发/可复用组件清单.md`
- 包含函数签名、参数说明、使用示例、注意事项
- 创建/修改组件后必须同步更新文档

---

## 三、核心导航链路

### 📱 典型用户操作流程

#### 1️⃣ 记账流程
```
LedgerScreen（记账主页）
  ↓ 点击"添加"按钮
AddTransactionScreen（新增交易）
  ↓ 选择分类
CategoryPicker（分类选择器）
  ↓ 选择账户
AccountSelector（账户选择器）
  ↓ 选择日期时间
DateTimePicker（日期时间选择器）
  ↓ 保存
TransactionDetailScreen（查看详情）
```

#### 2️⃣ 账户管理流程
```
UnifiedAccountAssetScreen（统一账户资产页）
  ├─ Tab 1: 资产总览
  │   ↓ 查看净资产、资产分布、趋势分析
  │   AssetOverviewContent
  │
  └─ Tab 2: 账户管理
      ↓ 查看所有账户
      AccountManagementContent
        ↓ 新增账户
        AddAccountScreen
        ↓ 编辑账户
        EditAccountScreen
        ↓ 账户间转账
        TransferScreen
```

#### 3️⃣ 设置流程
```
LedgerSettingsScreen（记账设置）
  ├─ 记账簿管理 → LedgerBookManagementScreen
  ├─ 分类管理 → CategoryManagementScreen
  ├─ 默认账户 → AccountSelectionScreen
  ├─ 币种选择 → CurrencySelectionScreen
  ├─ 提醒设置 → ReminderSettingsScreen
  ├─ 自动记账 → AutoLedgerSettingsScreen
  └─ 权限设置 → PermissionGuideScreen
```

---

## 四、ViewModel架构概览

### 主要ViewModel分类（40+个）

**事务处理**：
- LedgerViewModel（记账主页，320行待优化）
- AddTransactionViewModel、EditTransactionViewModel
- DeleteTransactionViewModel、FilterTransactionViewModel

**账户资产**：
- AccountViewModel、AssetOverviewViewModel
- TransferViewModel、AddAccountViewModel

**分类管理**：
- CategoryViewModel（共享）
- CategoryManagementViewModel、CategoryPickerViewModel

**信用卡/银行卡**：
- CreditCardDetailViewModel、CardViewModel
- PaymentViewModel、PaymentHistoryViewModel

**预算与储蓄**：
- BudgetViewModel、SavingsGoalViewModel
- ContributionViewModel

**统计与设置**：
- StatisticsViewModel、LedgerSettingsViewModel
- ReminderSettingsViewModel、AutoLedgerDebugViewModel

**导入导出**：
- ImportViewModel、QianjiImportViewModel

**其他**：
- LedgerCoordinatorViewModel（记账协调器）
- QuickLedgerViewModel（桌面小部件快速添加）
- DemoViewModel（Demo环境）

---

## 五、技术特性总结

### 🏗️ 架构设计

**Clean Architecture + MVVM模式**：
- **Data层**：Room DAOs + Repository模式
- **Domain层**：UseCase封装业务逻辑
- **Presentation层**：Compose UI + ViewModel状态管理

**依赖注入**：全模块Hilt支持

**导航系统**：
- Compose Navigation完整集成
- 路由集中定义在`LedgerNavigation`对象
- 支持带参数路由（如`transactionDetailRoute(id)`）

### 🎨 UI技术栈

- **100% Jetpack Compose**
- **Material 3 Design System**
- **自定义组件库**（AccountSelector、CategoryPicker等）
- **响应式状态管理**（StateFlow、SavedStateHandle）

### 💾 数据管理

**Room Database v23**（最新版本）：
- 28个表，其中11个记账相关表
- 完整的迁移链路（v1→v23）
- 支持二级分类（v9）、记账簿（v11）、银行卡（v17-v18）、增强提醒（v22-v23）

**关键表**：
- transactions（交易记录）
- accounts（账户）
- categories（分类，支持二级）
- ledgers（记账簿，v11+）
- cards（银行卡，v17+）
- credit_cards（信用卡）
- budgets（预算）
- savings_goals（储蓄目标）
- recurring_transactions（定期交易）

---

## 六、统计数据

### 📊 页面数量统计

| 模块 | 页面数 |
|------|--------|
| 交易管理 | 7 |
| 账户资产 | 6 |
| 分类管理 | 3 |
| 信用卡 | 7 |
| 银行卡 | 2 |
| 预算管理 | 2 |
| 储蓄目标 | 5 |
| 定期交易 | 2 |
| 统计分析 | 1 |
| 记账簿 | 1 |
| 批量操作 | 3 |
| 导入导出 | 2 |
| 设置配置 | 7 |
| 自动记账 | 3 |
| **正式环境总计** | **55+** |
| Demo演示 | 20+ |
| **总计** | **75+** |

### 📈 代码健康度

- **测试覆盖率**：约25-30%（目标45%）
- **架构一致性**：约85%（目标95%）
- **国际化进度**：41个文件待翻译
- **技术债务**：持续清理中，健康度约82%

---

## 七、关键技术亮点

### ⭐ 1. 统一账户资产页面设计

**架构创新**：
- 采用HorizontalPager + Tab架构，将资产总览和账户管理整合到一个页面
- 解决了用户在多页面间频繁跳转的痛点
- 组件化设计：AssetOverviewContent和AccountManagementContent可独立复用

**技术实现**：
```kotlin
// 使用HorizontalPager实现Tab切换
val pagerState = rememberPagerState { 2 }
HorizontalPager(state = pagerState) { page ->
    when (page) {
        0 -> AssetOverviewContent(viewModel = assetOverviewViewModel)
        1 -> AccountManagementContent(viewModel = accountViewModel)
    }
}
```

### ⭐ 2. 二级分类系统

**功能特性**：
- 支持"餐饮→早餐/午餐/晚餐"层级结构
- 智能缓存机制提升性能
- 钱迹应用数据迁移时自动映射到二级分类

**数据库设计**（v9升级）：
```sql
CREATE TABLE categories (
    id INTEGER PRIMARY KEY,
    name TEXT NOT NULL,
    parentId INTEGER,  -- NULL表示顶级分类
    type TEXT NOT NULL,  -- EXPENSE/INCOME
    FOREIGN KEY (parentId) REFERENCES categories(id)
)
```

### ⭐ 3. 自动记账架构

**完整流程**：
1. **PaymentNotificationListener** 监听支付通知
2. **AlipayNotificationParser** 解析交易信息（金额、商户、时间）
3. **AutoLedgerManager** 处理业务逻辑（去重、账户推荐、分类推荐）
4. **弹窗确认** 用户确认或修改后记账

**关键代码结构**：
```kotlin
// 通知解析
data class ParsedPaymentInfo(
    val amount: Double,
    val merchant: String,
    val transactionTime: LocalDateTime,
    val paymentMethod: PaymentMethod
)

// 自动记账管理
class AutoLedgerManager {
    suspend fun processPaymentNotification(info: ParsedPaymentInfo)
    suspend fun suggestCategory(merchant: String): Category?
    suspend fun suggestAccount(paymentMethod: PaymentMethod): Account?
}
```

### ⭐ 4. Demo环境独立性

**设计理念**：
- Demo页面与正式环境完全隔离（不同包路径）
- 支持UI创新实验，不影响生产稳定性
- 可复用组件强制文档化，提升团队协作效率

**V2版本策略**：
- V1（AddTransactionScreen）：稳定版本，生产环境使用
- V2（AddBillScreenV2）：实验版本，在Demo环境持续演进
- 待V2成熟后再决定是否替换V1

---

## 八、重要里程碑

### ✅ 已完成功能

| 时间 | 功能 | 数据库版本 |
|------|------|-----------|
| 2025-08-15 | 二级分类系统 | v9 |
| 2025-08-20 | 记账簿管理 | v11 |
| 2025-08-24 | 统一账户资产页面（Tab设计） | - |
| 2025-08-24 | 转账功能（关联交易记录） | v16 |
| 2025-08-25 | 自动记账导航修复（完整链路） | - |
| 2025-09-26 | 银行卡管理 | v17-v18 |
| 2025-10-04 | 增强提醒配置 | v22-v23 |
| 2025-10-04 | 桌面小部件（记账和倒计时） | - |
| 2025-10-05 | 依赖管理现代化（Version Catalog统一） | - |

### ⚠️ 已知问题

1. **LedgerViewModel过长**：320行（建议200行以内）
   - 建议拆分为：LedgerListViewModel、LedgerFilterViewModel、LedgerStatisticsViewModel

2. **自动记账弹窗不显示**：正在调查中（2025-08-25）
   - 已建立6点调试检查方案
   - 需要添加实时logcat日志定位失败环节

3. **国际化待完成**：41个文件需翻译
   - 优先完成高频页面：AddTransactionScreen、LedgerScreen、AccountScreen

---

## 九、快速访问路径

### 主要功能入口

| 功能 | 访问路径 |
|------|---------|
| 记账主页 | 主界面 → 记账Tab |
| 新增交易 | 记账主页 → "+"按钮 |
| 账户资产 | 侧边栏 → 账户与资产 |
| 统计分析 | 记账主页 → 统计Tab |
| 记账设置 | 个人页面 → 记账设置 |
| 分类管理 | 记账设置 → 分类管理 |
| 记账簿管理 | 记账设置 → 记账簿管理 |
| 自动记账 | 记账设置 → 自动记账权限设置 |
| 数据导入 | 记账设置 → 数据导入 |
| 数据导出 | 记账设置 → 数据导出 |
| Demo环境 | StyleCatalogDemoActivity（Debug版本） |

---

## 十、文件组织结构

```
feature/ledger/
├── src/main/kotlin/.../presentation/
│   ├── screen/                      # 正式页面
│   │   ├── ledger/                  # 记账主页
│   │   ├── transaction/             # 交易管理
│   │   ├── account/                 # 账户资产
│   │   ├── category/                # 分类管理
│   │   ├── creditcard/              # 信用卡
│   │   ├── card/                    # 银行卡
│   │   ├── budget/                  # 预算
│   │   ├── savings/                 # 储蓄目标
│   │   ├── recurring/               # 定期交易
│   │   ├── statistics/              # 统计分析
│   │   ├── ledgerbook/              # 记账簿
│   │   ├── batch/                   # 批量操作
│   │   ├── import/                  # 导入导出
│   │   ├── settings/                # 设置
│   │   ├── debug/                   # 调试工具
│   │   └── asset/                   # 资产相关
│   ├── viewmodel/                   # 所有 ViewModels
│   ├── component/                   # 共享 UI 组件
│   ├── navigation/                  # 导航定义
│   └── quickadd/                    # 快速添加
├── src/debug/kotlin/.../presentation/demo/
│   ├── stylecatalog/
│   │   ├── screens/                 # Demo 页面
│   │   ├── components/              # 可复用组件
│   │   ├── navigation/              # Demo 导航
│   │   └── viewmodel/               # Demo ViewModel
│   └── ...
├── domain/                          # 业务逻辑层
│   ├── model/                       # 领域模型
│   └── usecase/                     # 用例
└── data/                            # 数据层
    ├── local/                       # Room 数据库
    │   ├── dao/                     # DAO接口
    │   └── entity/                  # 实体类
    └── repository/                  # Repository实现
```

---

## 十一、架构演进启示

### 🎯 设计原则实践

#### 1. 功能内聚
每个页面职责单一，如AddTransactionScreen只负责交易录入，统计分析独立到StatisticsScreen。这种设计使得：
- 代码易于理解和维护
- 修改影响范围可控
- 组件可以独立测试

#### 2. 数据分离
账户、分类、交易、预算等领域数据各自独立表结构，通过外键关联而非字段冗余：
```sql
-- 交易表通过外键关联账户和分类
CREATE TABLE transactions (
    id INTEGER PRIMARY KEY,
    accountId INTEGER NOT NULL,
    categoryId INTEGER NOT NULL,
    amount REAL NOT NULL,
    FOREIGN KEY (accountId) REFERENCES accounts(id),
    FOREIGN KEY (categoryId) REFERENCES categories(id)
)
```

#### 3. 渐进式重构
V2版本回退到Demo环境继续演进，保持V1稳定性，体现了"双轨制"创新策略：
- **V1路线**：稳定的生产版本，保障用户体验
- **V2路线**：创新实验版本，探索更好的设计
- **风险隔离**：实验失败不影响主线功能

#### 4. 组件复用
CategoryPicker、AccountSelector等组件在多个页面复用，降低重复代码：
```kotlin
// 多个页面复用同一个分类选择器
@Composable
fun CategoryPicker(
    selectedCategory: Category?,
    onCategorySelected: (Category) -> Unit
) {
    // 统一的分类选择UI和逻辑
}
```

### 📊 模块化收益

通过Clean Architecture + MVVM的模块化架构，记账模块虽然包含75+页面，但：
- ✅ 各部分职责清晰，易于定位问题
- ✅ 新增功能只需扩展对应层，不影响其他部分
- ✅ 测试可以针对每层独立进行
- ✅ 团队协作可以并行开发不同功能模块

### 🔮 未来优化方向

1. **拆分LedgerViewModel**：按职责拆分为3个小ViewModel
2. **提升测试覆盖率**：从30%提升到45%，重点覆盖核心业务逻辑
3. **完成国际化**：支持多语言，拓展国际市场
4. **性能优化**：优化列表滚动性能，减少重组次数

---

## 附录：相关文档

### 架构文档
- `doc/架构迁移计划与原则.md` - 模块化架构迁移指南
- `doc/20250627-技术债务真实状态评估报告.md` - 技术债务评估

### 功能文档
- `doc/20250813-记账数据导出功能实施.md` - 导入导出功能实现
- `doc/20250815-数据导入问题修复.md` - 数据导入修复方案
- `doc/20250824-统一账户资产页面重构完整实施.md` - 统一账户资产页面设计

### Demo开发文档
- `doc/demo开发/可复用组件清单.md` ⭐ - Demo可复用组件文档

### 版本管理文档
- `Debug与Release版本切换指南.md` - 版本切换完整指南
- `版本切换快速参考.md` - 快速参考卡片

---

**文档维护者**：Claude Code
**最后更新**：2025-11-07
**文档版本**：1.0
