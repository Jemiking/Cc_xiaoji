# 2025-09-14 模仿钱迹界面开发 Demo 开发记录

本文记录本轮围绕“钱迹风格”Demo 的界面与系统栏、抽屉交互等优化过程与决策，便于后续继续迭代或回溯。

## 概述

- 目标：
  - 首页实现“分割式状态栏”（左白右蓝，随抽屉滑动实时变化）。
  - 抽屉改为推动式（不覆盖内容），并在 Demo 中提供精简菜单。
  - 所有业务卡片保持白色容器、左关键线 16dp 对齐。
  - 统一系统栏处理，避免新页面重复适配。

- 结果：
  - 首页分割状态栏已实现；抽屉默认使用原生手势（全屏可滑）。
  - 抽屉宽度回退为 Material 默认（保留原生体验、不左偏）。
  - 统一系统栏策略：由 Compose Insets 管理，避免“状态栏下空白”。
  - Demo 导航新增“设置·关于（占位）”，同时统一“账本设置”的入口行为。

## 关键决策与演进

1) 分割状态栏实现（首页生效）
- 方案：系统栏设为透明，页面顶层绘制一条状态栏高度的 Row：左侧为抽屉可见宽度（白色），右侧权重填充为蓝色（Blue500）。
- 统一色值：使用 `QianjiInspiredSpecs.Colors.Blue500`。

2) 抽屉宽度与“左偏”问题
- 起因：在 `DismissibleNavigationDrawer` 的 `DrawerSheet` 上直接设置了固定宽度（屏宽 75% 且不超过 400dp），该组件在关闭态也参与测量，导致内容区被挤窄、页面看起来“左偏”。
- 曾试方案（Plan A 自定义）：改为“覆盖式抽屉 + 内容位移”实现推动效果，可设 75%/400dp 且不左偏；但失去原生手势，需要自定义全屏拖拽。
- 最终决定：恢复原生 `DismissibleNavigationDrawer`，不再强制宽度；回归原生全屏滑动手势，避免左偏。抽屉宽度采用 Material 默认（约 320dp 上限）。

3) “设置·关于”与“账本设置”入口统一
- 抽屉中的“设置·关于”改为跳转到“占位页面”（待开发）。
- “我的账本”页面中，“日常账本卡片”右上角“三点”作为“账本设置”的入口（与期望一致）。

4) 中文文案与乱码清理
- 首页 Demo 文案统一为可读中文，如“本月 / 月支出 / 月收入 / 总额: 未设置 / 日用品 / 已使用1938天”等。

5) 系统栏处理统一方案（重要）
- 问题：非透明状态栏时，系统层已 `decorFitsSystemWindows=true` 将内容整体下移；`TopAppBar` 再应用 Insets，出现“状态栏下空白”。
- 统一策略（方案 A）：
  - 在 `SetStatusBar` 中一律 `WindowCompat.setDecorFitsSystemWindows(window, false)`，让 Compose Insets 统一处理。
  - 移除各页面针对 `TopAppBar` 的 `windowInsets = WindowInsets(0.dp)` 临时补丁。
  - 自定义头部的页面按需使用 `statusBarsPadding()`；使用 `TopAppBar` 的页面沿用其默认 Insets。

## 主要修改文件

- 首页 + 抽屉 + 分割状态栏
  - `feature/ledger/src/debug/kotlin/.../screens/ExpenseTrackerPreview.kt`
    - 回到原生 `DismissibleNavigationDrawer`（保留原生全屏手势）。
    - 顶部分割层：左白（由抽屉本体提供）、右蓝（内容区覆盖）。
    - 文案修复（去乱码）。

- 系统栏统一工具
  - `feature/ledger/src/debug/kotlin/.../theme/SystemBars.kt`
    - `SetStatusBar`：统一 `decorFitsSystemWindows=false`，由 Compose Insets 接管。

- 我的账本（统一入口 + 取消页面补丁）
  - `feature/ledger/src/debug/kotlin/.../screens/BooksScreen.kt`
    - “三点”点击跳 `LedgerSettings`。
    - 移除 `windowInsets = WindowInsets(0.dp)` 补丁。

- 卡片备份 / 分期·周期 / 设置·关于（占位）
  - `feature/ledger/src/debug/kotlin/.../screens/CardBackupScreen.kt`
  - `feature/ledger/src/debug/kotlin/.../screens/InstallmentsScreen.kt`
  - `feature/ledger/src/debug/kotlin/.../screens/DemoScreens.kt`（`DemoSettingsAboutScreen`）
    - 移除 `windowInsets = WindowInsets(0.dp)` 补丁。

- 导航与占位页
  - `feature/ledger/src/debug/kotlin/.../navigation/DemoNavigation.kt`
    - 新增 `SettingsAbout` 路由（设置·关于，占位）。
  - `feature/ledger/src/debug/kotlin/.../screens/DemoScreens.kt`
    - 新增 `DemoSettingsAboutScreen` 占位实现。

## 已知问题 / 后续选项

- 抽屉宽度：原生默认（约 320dp），在窄屏设备上看起来比例会偏大。
  - 若后续仍需“75% 且 ≤400dp”的视觉要求，并保持推动式与不左偏：建议回到自定义覆盖 + 内容位移方案，并加全屏横向拖拽手势（手感接近原生）。

- 个别页面无 TopAppBar 且未使用 `statusBarsPadding()` 时，可能顶到状态栏。
  - 处理方式：按页面布局意图补 `statusBarsPadding()` 或在容器上使用 `WindowInsets.statusBars.asPaddingValues()`。

## 变更摘要

- 恢复原生抽屉：手势回归、页面不左偏，宽度使用 Material 默认。
- 统一系统栏策略：Compose Insets 接管，删除页面级 TopAppBar 补丁。
- 导航与入口对齐：抽屉“设置·关于”改占位；账本设置从“我的账本卡片右上角”进入。
- 文案清理：首页 Demo 文案中文化与一致化。

---
如需恢复“自定义 75% 抽屉 + 全屏手势”的方案，可在此记录基础上继续迭代，避免回归“左偏”。

