# 数据导入边界案例测试方案

## 📋 项目概述

**项目名称**: 数据导入功能边界案例测试  
**文档版本**: v1.0  
**创建日期**: 2025-07-28  
**负责人**: Android开发团队  
**优先级**: P1 (关键功能验证)  

### 测试目标
验证 `importTodosFromCsv` 和 `importHabitsFromCsv` 方法在各种边界条件下的健壮性和数据完整性。

---

## 🎯 测试范围分析

### 被测方法规格

#### importTodosFromCsv
- **期望字段数**: ≥8个字段
- **字段结构**: id, title, description, completed, priority, dueAt, createdAt, updatedAt
- **关键转换**: Boolean, Int, Timestamp解析
- **批量插入**: 使用 `TaskDao.insertTasks()`

#### importHabitsFromCsv  
- **期望字段数**: ≥9个字段
- **字段结构**: id, title, description, period, target, color, icon, createdAt, updatedAt
- **关键转换**: Int, Timestamp解析
- **单个插入**: 使用 `HabitDao.insertHabit()`

---

## 📝 边界测试用例设计

### 类别1: 字段数量边界测试

#### TC-01: 字段不足测试
**目标**: 验证字段数量不足时的处理
- **Todo数据**: 少于8个字段的记录
- **Habit数据**: 少于9个字段的记录
- **预期结果**: 记录被跳过，不影响其他记录导入

#### TC-02: 字段过多测试  
**目标**: 验证额外字段的处理
- **测试数据**: 包含10-15个字段的记录
- **预期结果**: 正常导入，忽略额外字段

#### TC-03: 空行和混合数据测试
**目标**: 验证CSV中空行的处理
- **测试数据**: 包含空行、有效行、无效行的混合CSV
- **预期结果**: 空行跳过，有效记录正常导入

### 类别2: 数据类型转换边界测试

#### TC-04: 布尔值转换测试 (Todo专用)
**目标**: 验证completed字段的各种布尔表示
- **测试数据**: "true", "false", "1", "0", "TRUE", "False", "yes", "no"
- **预期结果**: 
  - 标准布尔值正常转换
  - 非标准格式触发异常，记录跳过

#### TC-05: 整数转换测试
**目标**: 验证priority(Todo)和target(Habit)字段转换
- **测试数据**: 
  - 正常整数: "1", "999"
  - 边界值: "0", "-1", "2147483647" (Int.MAX_VALUE)
  - 异常值: "abc", "12.5", "", "null"
- **预期结果**: 正常整数转换成功，异常值导致记录跳过

#### TC-06: 时间戳解析测试
**目标**: 验证createdAt/updatedAt字段解析
- **测试数据**: 
  - 标准ISO格式: "2025-07-28T12:00:00Z"
  - 边界时间: "1970-01-01T00:00:00Z", "2099-12-31T23:59:59Z"
  - 异常格式: "2025-07-28", "invalid", ""
- **预期结果**: 标准格式解析成功，异常格式导致记录跳过

### 类别3: 空值和特殊字符测试

#### TC-07: 可空字段测试
**目标**: 验证description, dueAt, icon等可空字段处理
- **测试数据**: 
  - 空字符串: ""
  - 空白字符: " ", "\t", "\n"  
  - null值表示: "null", "NULL"
- **预期结果**: 空值被正确转换为null，空白字符被清理

#### TC-08: 特殊字符测试
**目标**: 验证CSV转义和特殊字符处理
- **测试数据**:
  - 包含逗号的标题: "任务1,重要"
  - 包含引号的描述: "这是\"重要\"任务"
  - 包含换行的描述: "第一行\n第二行"
  - Unicode字符: "📝 任务", "🏃‍♂️ 跑步"
- **预期结果**: 特殊字符正确保存到数据库

#### TC-09: 长文本测试
**目标**: 验证超长文本的处理
- **测试数据**:
  - 标题: 1000字符长度
  - 描述: 10000字符长度
- **预期结果**: 根据数据库字段限制截断或完整保存

### 类别4: 大数据量测试

#### TC-10: 批量数据性能测试
**目标**: 验证大量数据导入的性能和稳定性
- **测试规模**:
  - 小批量: 100条记录
  - 中批量: 10,000条记录  
  - 大批量: 100,000条记录
- **监控指标**:
  - 导入耗时
  - 内存使用峰值
  - 是否发生OOM
- **预期结果**: 在合理时间内完成，无内存泄漏

#### TC-11: 混合错误数据测试
**目标**: 验证大量数据中部分错误记录的处理
- **测试数据**: 10,000条记录，其中20%包含各种错误
- **预期结果**: 正确记录导入成功，错误记录被跳过并记录日志

### 类别5: 并发和事务测试

#### TC-12: 导入中断测试
**目标**: 验证导入过程中断时的事务回滚
- **测试方法**: 
  - 导入过程中模拟应用崩溃
  - 导入过程中断开网络连接
  - 导入过程中删除文件
- **预期结果**: 事务完整回滚，数据库状态不受影响

#### TC-13: 重复ID测试
**目标**: 验证重复ID记录的处理
- **测试数据**: 包含相同ID但不同内容的记录
- **预期结果**: 根据数据库REPLACE策略，后导入的记录覆盖先导入的

#### TC-14: 外键约束测试  
**目标**: 验证用户ID等外键字段的处理
- **测试数据**: 使用不存在的用户ID
- **预期结果**: 根据外键约束策略处理（可能跳过或使用默认值）

### 类别6: 文件系统边界测试

#### TC-15: 文件损坏测试
**目标**: 验证CSV文件损坏时的处理
- **测试场景**:
  - 文件截断（不完整的最后一行）
  - 编码错误（非UTF-8字符）
  - 二进制数据混入
- **预期结果**: 优雅处理错误，不导致应用崩溃

#### TC-16: 超大文件测试
**目标**: 验证大文件的处理能力
- **测试数据**: 
  - 文件大小: 100MB, 500MB, 1GB
  - 记录数量: 1M+ 记录
- **预期结果**: 在内存限制内正常处理或提供友好错误提示

---

## 📊 测试数据样本设计

### Todo数据样本

#### 正常数据
```csv
id,title,description,completed,priority,dueAt,createdAt,updatedAt
todo-001,完成项目报告,月度总结报告,false,1,2025-08-01T10:00:00Z,2025-07-28T12:00:00Z,2025-07-28T12:00:00Z
todo-002,团队会议,,true,2,,2025-07-28T09:00:00Z,2025-07-28T14:00:00Z
```

#### 边界测试数据
```csv
id,title,description,completed,priority,dueAt,createdAt,updatedAt
# 字段不足测试
todo-003,缺少字段,描述,false,1

# 类型转换错误测试  
todo-004,优先级错误,描述,false,abc,2025-08-01T10:00:00Z,2025-07-28T12:00:00Z,2025-07-28T12:00:00Z

# 时间格式错误测试
todo-005,时间错误,描述,false,1,2025-08-01T10:00:00Z,invalid-date,2025-07-28T12:00:00Z

# 特殊字符测试
todo-006,"包含,逗号的标题","包含""引号""的描述",false,1,,2025-07-28T12:00:00Z,2025-07-28T12:00:00Z

# 长文本测试
todo-007,[1000字符长度的标题],[10000字符长度的描述],false,1,,2025-07-28T12:00:00Z,2025-07-28T12:00:00Z
```

### Habit数据样本

#### 正常数据
```csv
id,title,description,period,target,color,icon,createdAt,updatedAt
habit-001,每日跑步,保持健康,daily,1,#FF5722,🏃,2025-07-28T12:00:00Z,2025-07-28T12:00:00Z
habit-002,阅读,,weekly,7,#2196F3,,2025-07-28T12:00:00Z,2025-07-28T12:00:00Z
```

#### 边界测试数据
```csv
id,title,description,period,target,color,icon,createdAt,updatedAt
# 字段不足测试
habit-003,缺少字段,描述,daily,1

# 目标值边界测试
habit-004,负数目标,描述,daily,-1,#FF5722,🏃,2025-07-28T12:00:00Z,2025-07-28T12:00:00Z
habit-005,最大目标,描述,daily,2147483647,#FF5722,🏃,2025-07-28T12:00:00Z,2025-07-28T12:00:00Z

# 特殊字符测试
habit-006,"包含,逗号",描述,daily,1,#FF5722,🎯,2025-07-28T12:00:00Z,2025-07-28T12:00:00Z
```

---

## 🚀 测试执行计划

### 第一阶段: 基础边界测试 (预计2小时)
1. **TC-01到TC-03**: 字段数量边界测试
2. **TC-04到TC-06**: 数据类型转换测试
3. **TC-07到TC-09**: 空值和特殊字符测试

### 第二阶段: 性能边界测试 (预计3小时)
1. **TC-10**: 大数据量测试（分阶段：100→10K→100K）
2. **TC-11**: 混合错误数据测试
3. **TC-16**: 超大文件测试

### 第三阶段: 系统边界测试 (预计2小时)
1. **TC-12**: 导入中断测试
2. **TC-13到TC-14**: 数据一致性测试
3. **TC-15**: 文件损坏测试

### 测试环境要求
- **设备配置**: 至少2GB可用内存
- **存储空间**: 至少5GB可用空间  
- **测试数据**: 准备各类型边界测试文件
- **监控工具**: 内存监控、性能分析工具

### 验收标准
1. **健壮性**: 边界条件下应用不崩溃
2. **数据完整性**: 正确数据100%导入成功
3. **错误处理**: 错误数据被正确跳过并记录日志
4. **性能要求**: 10K记录导入时间<30秒，内存使用<500MB
5. **事务安全**: 中断导入后数据库状态一致

---

## 📋 测试记录模板

### 测试用例执行记录
```
测试用例: TC-XX
执行时间: YYYY-MM-DD HH:MM:SS
测试数据: [描述测试数据]
执行步骤: [具体操作步骤]
实际结果: [详细记录结果]
是否通过: ✅/❌
问题描述: [如有问题，详细描述]
修复建议: [提出修复方案]
```

### 性能测试记录
```
数据规模: XXX条记录
文件大小: XXX MB
导入耗时: XXX秒  
内存峰值: XXX MB
CPU使用率: XXX%
成功记录数: XXX
失败记录数: XXX
错误日志数: XXX
```

---

## 🔗 相关文档
- [数据导出和导入问题修复-1](./20250728-数据导出和导入问题修复-1.md)
- [CsvBackupProvider源码](../../app/src/main/kotlin/com/ccxiaoji/app/data/backup/CsvBackupProvider.kt)

---

**最后更新**: 2025-07-28 21:45  
**状态**: 边界测试方案完全制定完成 ✅  

## ✅ 测试方案制定完成总结 (2025-07-28 21:45)

### 已完成工作
1. ✅ **详细测试方案**: 制定了6大类别、16个具体测试用例
2. ✅ **综合测试数据**: 创建了完整的边界测试CSV文件
   - `comprehensive_todos_boundary.csv` - 包含54个边界测试用例
   - `comprehensive_habits_boundary.csv` - 包含51个边界测试用例
   - `mixed_error_todos.csv` - 25条记录的混合错误测试数据
3. ✅ **性能测试工具**: 提供了Python脚本生成大规模测试数据
4. ✅ **执行检查清单**: 创建了详细的测试执行指南

### 测试覆盖范围
- **字段边界**: 字段不足、字段过多、空行处理
- **数据类型**: 布尔转换、整数转换、时间戳解析  
- **特殊字符**: CSV转义、Unicode、长文本
- **性能边界**: 100/1000/10000条记录性能测试
- **系统边界**: 中断恢复、数据一致性、文件损坏
- **错误处理**: 混合错误数据、重复ID、外键约束

### 技术亮点
- **全面性**: 覆盖了importTodosFromCsv和importHabitsFromCsv的所有边界场景
- **实用性**: 提供了可直接执行的测试文件和脚本
- **可追踪**: 包含详细的执行记录模板和验收标准
- **自动化**: Python脚本可生成任意规模的测试数据

### 文件结构
```
test_backup_data/
├── edge_cases/
│   ├── comprehensive_todos_boundary.csv      # 54个Todo边界测试用例
│   ├── comprehensive_habits_boundary.csv     # 51个Habit边界测试用例  
│   ├── mixed_error_todos.csv                # 混合错误测试数据
│   ├── generate_performance_data.py         # 性能测试数据生成脚本
│   ├── malformed_todos.csv                  # 原有格式错误测试
│   └── malformed_habits.csv                 # 原有格式错误测试
└── 边界测试执行清单.md                       # 完整的测试执行指南
```

**下一步**: 开发者可使用生成脚本创建大规模测试数据，然后按照执行清单进行系统性的边界案例测试