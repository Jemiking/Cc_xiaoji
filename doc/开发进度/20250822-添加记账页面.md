# 2025-08-22｜添加记账页面（记录）

本页为 2025-08-22 的设计迭代记录。重点推进记账模块“添加账单”页面的键盘与头部布局方案 Demo，用于后续跨模块（含排班）统一交互与密度策略的对照参考。

## 背景与目标

- 背景：记账模块“添加账单”页底部自定义键盘在小屏设备上第 4 行显示不全，且上方“记账簿/账户/功能按钮”占位不够紧凑。
- 目标：制作一个不影响现有正式页面的 Demo，集成“方案B（键盘固定底部、上方可滚动）”并优化头部布局，作为后续逐步推广与统一的参考实现。

## 本次产出（Demo）

- 新增页面：`feature/ledger/presentation/screen/demo/AddTransactionKeyboardBDemoScreen.kt`
  - 键盘固定底部（4×4），上方区域可滚动（方案B）。
  - 行1：左“备注输入框” + 右“金额显示”（按收入/支出变色）。
  - 行2（同一行）：左“记账簿图标按钮 + 报销/图片/购物车”图标，右“账户文字按钮”（显示账户名：现金/支付宝/自定义）。
  - 去除“联动”按钮；保留“记账簿选择器”、“分类选择器”对话框，使用真实 ViewModel（可保存）。

- 设置入口：在“记账设置 → 高级设置”新增“添加账单（方案B Demo）”便于快速预览对比。
  - 相关改动：
    - `AdvancedSettingsSection.kt`：增加入口项。
    - `LedgerSettingsScreen.kt`：增加 `showAddTransactionBDemo` 状态与弹出逻辑。

## 关键实现要点

- 解决“键盘第4行被挤出视口”的核心方式：
  - 移除固定高度的“输入区域”，采用“上方内容 verticalScroll + 键盘固定底部”的结构。
  - 键盘容器保留左右与底部内边距，预留导航栏区域，保证点击友好（48dp 高度）。

- 头部布局紧凑化：
  - 按钮行与账户按钮合并为一行，减少垂直占用；账户以文字呈现更明确直观。
  - 记账簿使用图标按钮（书本 Icon），统一与其它功能图标风格。

## 使用方法（验证）

1. 打开应用 → 记账设置 → 高级设置 → “添加账单（方案B Demo）”。
2. 在 Demo 中：
   - 点击书本图标选择记账簿；右侧文字按钮显示当前账户名。
   - 使用键盘输入金额；“保存”会调用真实保存逻辑并返回。
3. 观察小屏下键盘是否完整可见、上方滚动是否顺畅、交互是否符合预期。

## 已知风险与兼容性

- 迁移历史数据库的设备可能因旧版迁移脚本不一致导致启动时迁移失败（已定位并提出修复方案）。Debug 环境建议“卸载重装/清数据”以走全量建表路径。
- Demo 未接入账户切换弹窗（当前仅展示名称）；正式落地时再接入。

## 后续计划（逐步落地）

1. 记账模块正式页面落地方案B：
   - 去除固定高度输入区域；改为“上方滚动 + 底部固定键盘”。
   - 统一第二行的“记账簿图标 + 功能图标 + 账户文字按钮”，移除联动按钮入口。
   - 适配导航栏、暗色主题与横屏/平板场景。

2. 跨模块参考与复用（关联排班主页设计）：
   - 将本次“密度/行高/滚动与固定区分离”的结构作为排班主页底部操作条的参考模板，统一交互节奏与触达面积。

3. 验证与回归：
   - 小屏设备与全面屏手势导航下的点击可达性回归。
   - 保存、分类选择、记账簿选择等基础流程回归。

## 验收清单（本次 Demo）

- [x] 键盘第 4 行在小屏完整可见。
- [x] 上方内容滚动流畅，键盘固定不抖动。
- [x] 第二行合并：记账簿图标 + 功能图标 + 账户文字按钮。
- [x] 记账簿、分类选择器正常弹出与关闭。
- [x] 金额输入、保存流程可用（使用真实 ViewModel）。

—— 记录人：ultrathink（Agent）
