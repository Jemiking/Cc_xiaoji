# CC小记技术债务清除路线图

## 概述
- **创建时间**: 2025-06-27 21:00
- **当前状态**: 技术债务健康度79%，部分清除
- **目标**: 渐进式达到95%+健康度
- **策略**: 稳定优先，小步快跑

## 一、当前技术债务概况

### 健康度评分（79/100）
```
✅ 已完成: 27项
❌ 未完成: 7项（主要是版本目录）
⚠️ 部分完成: 4项
```

### 核心问题
1. **版本管理**: 7个模块硬编码版本（每个15-20个依赖）
2. **测试覆盖**: 25-30%（目标45%）
3. **代码优化**: LedgerViewModel 320行（目标200行）
4. **未提交文件**: 630个文件待处理

## 二、分阶段清除计划

### 🚀 第0阶段：稳定现状（立即执行）
**时间**: 1天  
**目标**: 确保现有功能稳定

#### 任务清单
- [ ] 备份630个未提交文件
  ```bash
  git stash save "backup-before-debt-cleanup-20250627"
  # 或
  git checkout -b backup-20250627
  git add .
  git commit -m "备份：技术债务清除前状态"
  ```
- [ ] 手动测试核心功能
  - 记账功能（特别是分类系统）
  - Todo管理
  - 习惯打卡
- [ ] 记录当前已知问题

### 📋 第1阶段：快速改善（1周内）
**时间**: 3-5天  
**目标**: 健康度提升到85%+

#### 优先任务
1. **修复关键版本目录问题**
   - [ ] 修复core/network硬编码版本
   - [ ] 修复core/ui硬编码版本
   - 理由：core模块影响所有feature模块

2. **提升测试覆盖率到35%**
   - [ ] 为关键UseCase添加测试
   - [ ] 为Repository添加测试
   - [ ] 运行覆盖率报告

3. **处理未提交文件**
   - [ ] Review重要更改（特别是ledger和plan模块）
   - [ ] 分批提交（每批100个文件）
   - [ ] 创建有意义的提交信息

### 🔧 第2阶段：核心优化（2周内）
**时间**: 1周  
**目标**: 健康度提升到90%+

#### 核心任务
1. **版本目录完全迁移**
   - [ ] 修复shared/*模块（4个）
   - [ ] 修复feature/plan模块
   - [ ] 运行技术债务检查脚本验证

2. **代码质量提升**
   - [ ] 优化LedgerViewModel到250行以内
   - [ ] 完成Ledger模块剩余国际化
   - [ ] 清理明显的代码重复

3. **测试覆盖率到40%**
   - [ ] 添加集成测试
   - [ ] 覆盖关键业务逻辑

### 🎯 第3阶段：完善细节（1个月内）
**时间**: 2周  
**目标**: 健康度达到95%+

#### 完善任务
1. **彻底清除技术债务**
   - [ ] LedgerViewModel优化到200行
   - [ ] 测试覆盖率达到45%
   - [ ] 所有硬编码版本消除

2. **建立预防机制**
   - [ ] CI/CD集成技术债务检查
   - [ ] 代码审查清单更新
   - [ ] 自动化版本更新机制

3. **文档完善**
   - [ ] 更新所有技术文档
   - [ ] 创建最佳实践指南
   - [ ] 记录架构决策

## 三、执行原则

### ✅ 应该做的
1. **小步快跑**: 每次改动控制在可验证范围
2. **持续集成**: 每完成一项立即验证
3. **文档先行**: 改动前先更新文档
4. **测试驱动**: 先写测试再改代码

### ❌ 不应该做的
1. **大规模重构**: 避免一次性改动过多
2. **功能变更**: 清除债务时不改功能
3. **跳过测试**: 每个改动必须测试
4. **忽视风险**: 高风险操作需备份

## 四、风险管理

### 风险矩阵
| 风险 | 概率 | 影响 | 缓解措施 |
|------|------|------|----------|
| 引入新bug | 中 | 高 | 充分测试+代码审查 |
| 进度延误 | 高 | 中 | 灵活调整优先级 |
| 功能回归 | 低 | 高 | 保持备份+快速回滚 |
| 依赖冲突 | 中 | 中 | 逐步迁移+兼容性测试 |

### 回滚计划
```bash
# 如果出现严重问题
git checkout backup-20250627
# 或
git stash pop
```

## 五、成功标准

### 第1阶段成功标准
- [ ] 技术债务健康度 ≥ 85%
- [ ] 核心功能无回归
- [ ] 测试覆盖率 ≥ 35%

### 第2阶段成功标准
- [ ] 技术债务健康度 ≥ 90%
- [ ] 版本目录覆盖率 100%
- [ ] 测试覆盖率 ≥ 40%

### 第3阶段成功标准
- [ ] 技术债务健康度 ≥ 95%
- [ ] 所有技术债务清除
- [ ] 预防机制建立

## 六、快速参考

### 常用命令
```bash
# 运行技术债务检查
bash scripts/check_technical_debt.sh

# 查看未提交文件
git status --short | wc -l

# 测试覆盖率
./gradlew jacocoTestReport

# 编译验证
./gradlew build
```

### 相关文档
- [技术债务真实状态评估报告](./20250627-技术债务真实状态评估报告.md)
- [代码风格统一技术债务](./20250620-代码风格统一技术债务.md)
- [技术债务跟踪表](./20250620-技术债务跟踪表.md)

## 七、每日检查清单

### 开始工作前
- [ ] 拉取最新代码
- [ ] 运行技术债务检查脚本
- [ ] 确认没有新增技术债务

### 完成工作后
- [ ] 运行所有测试
- [ ] 验证技术债务健康度
- [ ] 更新进度文档

---
*创建时间: 2025-06-27 21:00*  
*负责人: 开发团队*  
*下次评审: 2025-07-04*