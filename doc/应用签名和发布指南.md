# CC小记 - 应用签名和发布指南

## 概述

本指南将帮助你从开发版本转换到正式发布版本，包括创建签名密钥、配置构建脚本和生成发布APK。

## 签名类型对比

| 签名类型 | 用途 | 安全性 | 发布渠道 |
|---------|------|--------|----------|
| Debug签名 | 开发调试 | 低（公开密钥） | 只能内部测试 |
| Release签名 | 正式发布 | 高（私有密钥） | 应用商店、正式分发 |

## 🚀 快速开始

### 步骤1: 创建发布密钥库

```bash
# 运行密钥库创建脚本
cd scripts
create_release_keystore.bat
```

**填写信息示例：**
- 密钥别名: `ccxiaoji_release`
- 密钥库密码: `你的强密码123!`
- 密钥密码: `你的强密码123!`
- 有效期: `25年`
- 姓名: `CC小记开发团队`
- 组织单位: `CC小记`
- 组织: `你的公司名`
- 城市: `你的城市`
- 省份: `你的省份`
- 国家代码: `CN`

### 步骤2: 配置签名信息

```bash
# 复制配置文件模板
copy keystore.properties.example keystore.properties

# 编辑 keystore.properties 文件
```

**keystore.properties 内容：**
```properties
storeFile=ccxiaoji_release.keystore
storePassword=你的密钥库密码
keyAlias=ccxiaoji_release
keyPassword=你的密钥密码
```

### 步骤3: 构建发布版本

```bash
# 运行发布构建脚本
cd scripts
build_release.bat
```

## 📁 文件结构

构建完成后，文件结构如下：

```
D:\kotlin\Cc_xiaoji\
├── ccxiaoji_release.keystore     # 密钥库文件（重要！）
├── keystore.properties           # 签名配置（重要！）
├── keystore.properties.example   # 配置模板
└── app\build\outputs\apk\release\
    └── app-release.apk           # 正式发布APK
```

## 🔐 安全注意事项

### 密钥库安全
1. **备份密钥库**: 将 `ccxiaoji_release.keystore` 存储在安全位置
2. **密码管理**: 记录密钥库密码和密钥密码
3. **不要提交**: 密钥库和配置文件已加入 `.gitignore`

### 密钥丢失后果
- ⚠️ **无法更新应用**: Google Play 需要相同签名
- ⚠️ **需要新包名**: 丢失密钥需要发布新应用
- ⚠️ **用户无法升级**: 签名不同无法覆盖安装

## 📱 安装和测试

### 卸载开发版本
```bash
# 如果设备上有debug版本，需要先卸载
adb uninstall com.ccxiaoji.app
```

### 安装发布版本
```bash
# 安装正式签名版本
adb install app\build\outputs\apk\release\app-release.apk
```

### 验证签名
```bash
# 检查APK签名信息
aapt dump badging app\build\outputs\apk\release\app-release.apk | findstr package
```

## 🏪 发布渠道

### Google Play Store
1. 创建开发者账户（$25一次性费用）
2. 上传APK到Google Play Console
3. 设置应用信息、截图、描述
4. 提交审核

### 华为应用市场
1. 注册华为开发者账户
2. 上传APK到AppGallery Connect
3. 填写应用信息
4. 提交审核

### 其他应用商店
- 小米应用商店
- OPPO软件商店
- vivo应用商店
- 应用宝（腾讯）

## 🛠️ 版本管理

### 版本号更新
编辑 `app/build.gradle.kts`：

```kotlin
defaultConfig {
    versionCode = 251     // 每次发布递增
    versionName = "2.5.1" // 显示给用户的版本
}
```

### 版本命名规范
- **主版本**: 重大架构变更 (2.x.x)
- **次版本**: 新功能添加 (x.5.x)  
- **修订版本**: Bug修复 (x.x.1)

## 🔧 高级配置

### ProGuard优化
发布版本已启用代码混淆和优化：

```kotlin
release {
    isMinifyEnabled = true
    proguardFiles(
        getDefaultProguardFile("proguard-android-optimize.txt"),
        "proguard-rules.pro"
    )
}
```

### 多渠道打包
可以配置不同渠道的变体：

```kotlin
android {
    flavorDimensions += "channel"
    productFlavors {
        create("googleplay") {
            dimension = "channel"
            versionNameSuffix = "-gp"
        }
        create("huawei") {
            dimension = "channel"
            versionNameSuffix = "-hw"
        }
    }
}
```

## ❗ 常见问题

### Q: 构建失败提示"keystore not found"
**A**: 检查 `keystore.properties` 文件是否存在且配置正确

### Q: 安装时提示"签名冲突"
**A**: 卸载设备上的debug版本后重新安装

### Q: 密钥库密码忘记了怎么办？
**A**: 无法恢复，需要重新创建密钥库（会影响应用更新）

### Q: 可以在多台电脑上构建吗？
**A**: 可以，需要将密钥库文件和配置文件复制到其他电脑

## 📞 技术支持

如果遇到问题，请检查：
1. JDK版本是否正确（需要JDK 17+）
2. Gradle构建环境是否正常
3. 密钥库文件权限是否正确

---
*最后更新：2025-08-17*
*CC小记开发团队*