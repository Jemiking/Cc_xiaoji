# 📊 CC小记数据存储功能详细清单

根据代码分析，项目的数据存储功能包括以下几个方面：

## 1. Room数据库存储（主存储）

- **数据库文件**: cc_xiaoji.db（版本7）
- **23个数据表**：
  - 用户数据：UserEntity
  - 任务管理：TaskEntity
  - 习惯管理：HabitEntity, HabitRecordEntity
  - 记账系统：12个实体（账户、交易、分类、预算等）
  - 排班管理：4个实体（班次、排班、模式、导出历史）
  - 计划管理：3个实体（计划、里程碑、模板）
  - 系统功能：CountdownEntity, ChangeLogEntity

## 2. DataStore存储（配置存储）

- **文件**: cc_xiaoji_prefs
- **存储内容**：
  - 用户认证：user_id, access_token, refresh_token
  - 同步信息：last_sync_time, server_time
  - 当前用户：current_user_id

## 3. 文件系统存储

- **数据库备份**：
  - 位置：/CcXiaojiBackup/
  - 格式：cc_xiaoji_backup_[时间戳].db
  - 策略：最多保留5个备份文件
  
- **数据导出**：
  - 格式：JSON、CSV、Excel
  - 内容：交易记录、任务、习惯、账户等
  - 方式：通过FileProvider分享

- **排班导出**：
  - 专门的Excel导出功能
  - 导出历史记录在数据库中

## 4. 数据同步存储

- **变更日志**：ChangeLogEntity记录所有数据变更
- **同步状态**：每个实体都有syncStatus字段
- **同步队列**：待同步数据的本地缓存

## 5. 缓存存储

- **Repository层缓存**：使用Flow自动缓存查询结果
- **内存缓存**：频繁访问的数据缓存在内存中

## 6. 安全存储

- **加密存储**：使用androidx.security.crypto
- **敏感数据**：token等敏感信息加密保存

## 7. 临时存储

- **应用缓存目录**：用于临时文件
- **外部文件目录**：用于导出文件

## 8. 数据迁移机制

- **6次数据库迁移**：从v1到v7
- **迁移管理**：DatabaseMigrations统一管理
- **开发迁移**：DevMigrations支持开发环境

这些存储功能共同构成了CC小记完整的数据持久化方案，满足了离线使用、数据同步、备份恢复等各种需求。

---
*文档创建时间: 2025-06-30*  
*文档类型: 技术文档*  
*分析基于: 项目代码实际实现*