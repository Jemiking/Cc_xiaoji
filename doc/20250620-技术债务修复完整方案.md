# CCå°è®°æŠ€æœ¯å€ºåŠ¡ä¿®å¤å®Œæ•´æ–¹æ¡ˆ

## ä¿®å¤ç›®æ ‡
1. è§£å†³æ¨¡å—é—´æŠ€æœ¯æ ˆä¸ä¸€è‡´é—®é¢˜
2. å»ºç«‹å¯æŒç»­çš„æ¨¡å—é…ç½®æ ‡å‡†
3. é˜²æ­¢æŠ€æœ¯å€ºåŠ¡å†æ¬¡ç´¯ç§¯
4. æå‡å¼€å‘æ•ˆç‡å’Œä»£ç è´¨é‡

## ä¸€ã€ç´§æ€¥ä¿®å¤é¡¹ï¼ˆP0çº§ - ç«‹å³æ‰§è¡Œï¼‰

### 1.1 ä¿®å¤Roomç¼–è¯‘å™¨ç¼ºå¤±é—®é¢˜
**å½±å“æ¨¡å—**ï¼šfeature-todo, feature-ledger
**ä¿®å¤æ—¶é—´**ï¼š30åˆ†é’Ÿ

```kotlin
// åœ¨feature-todoå’Œfeature-ledgerçš„build.gradle.ktsä¸­æ·»åŠ 
dependencies {
    ksp(libs.room.compiler)  // ä½¿ç”¨ç‰ˆæœ¬ç›®å½•
}
```

### 1.2 éªŒè¯ç¼–è¯‘å®Œæ•´æ€§
```bash
# æ¸…ç†å¹¶é‡æ–°ç¼–è¯‘ï¼Œç¡®ä¿Roomä»£ç ç”Ÿæˆæ­£ç¡®
./gradlew clean
./gradlew :feature:todo:build
./gradlew :feature:ledger:build
```

## äºŒã€ç‰ˆæœ¬ç®¡ç†æ ‡å‡†åŒ–ï¼ˆP1çº§ - 1å¤©å†…å®Œæˆï¼‰

### 2.1 åˆ›å»ºGradle Conventionæ’ä»¶
åˆ›å»ºç»Ÿä¸€çš„æ¨¡å—é…ç½®æ’ä»¶ï¼Œç¡®ä¿æ‰€æœ‰featureæ¨¡å—æœ‰ä¸€è‡´çš„åŸºç¡€é…ç½®ã€‚

**æ–‡ä»¶**ï¼š`buildSrc/src/main/kotlin/ccxiaoji.android.feature.gradle.kts`

```kotlin
plugins {
    id("com.android.library")
    id("org.jetbrains.kotlin.android")
    id("com.google.devtools.ksp")
    id("dagger.hilt.android.plugin")
}

android {
    compileSdk = libs.versions.compileSdk.get().toInt()
    buildToolsVersion = libs.versions.buildTools.get()

    defaultConfig {
        minSdk = libs.versions.minSdk.get().toInt()
        testInstrumentationRunner = "androidx.test.runner.AndroidJUnitRunner"
    }

    compileOptions {
        sourceCompatibility = JavaVersion.VERSION_17
        targetCompatibility = JavaVersion.VERSION_17
        // ç»Ÿä¸€å¯ç”¨Desugaring
        isCoreLibraryDesugaringEnabled = true
    }

    kotlinOptions {
        jvmTarget = "17"
        freeCompilerArgs = listOf(
            "-Xjsr305=strict",
            "-Xjvm-default=all",
            "-opt-in=kotlin.RequiresOptIn"
        )
    }

    buildFeatures {
        compose = true
    }

    composeOptions {
        kotlinCompilerExtensionVersion = libs.versions.compose.compiler.get()
    }
}

dependencies {
    // åŸºç¡€ä¾èµ–ï¼ˆæ‰€æœ‰featureæ¨¡å—éƒ½éœ€è¦ï¼‰
    implementation(libs.bundles.android.core)
    implementation(libs.bundles.compose.ui)
    implementation(libs.bundles.lifecycle)
    implementation(libs.androidx.navigation.compose)
    implementation(libs.hilt.android)
    implementation(libs.hilt.navigation.compose)
    ksp(libs.hilt.compiler)
    
    // RoomåŸºç¡€ä¾èµ–
    implementation(libs.bundles.room)
    ksp(libs.room.compiler)
    
    // Desugaring
    coreLibraryDesugaring(libs.desugar.jdk.libs)
    
    // æµ‹è¯•ä¾èµ–
    testImplementation(libs.bundles.testing)
    androidTestImplementation(libs.bundles.android.testing)
    debugImplementation(libs.bundles.compose.debug)
}
```

### 2.2 æ›´æ–°libs.versions.toml
æ·»åŠ ç¼ºå¤±çš„ç‰ˆæœ¬å’Œåº“å®šä¹‰ï¼š

```toml
[versions]
# æ·»åŠ ç¼ºå¤±çš„ç‰ˆæœ¬
desugar = "2.0.4"
agp = "8.3.0"

[libraries]
# æ·»åŠ ç¼ºå¤±çš„åº“
desugar-jdk-libs = { group = "com.android.tools", name = "desugar_jdk_libs", version.ref = "desugar" }
androidx-lifecycle-viewmodel-compose = { group = "androidx.lifecycle", name = "lifecycle-viewmodel-compose", version.ref = "lifecycle" }

[bundles]
# ä¸ºfeatureæ¨¡å—åˆ›å»ºç‰¹å®šbundle
feature-core = [
    "androidx-core-ktx",
    "kotlin-coroutines",
    "kotlin-datetime",
    "hilt-android"
]
```

### 2.3 è¿ç§»æ‰€æœ‰æ¨¡å—åˆ°ç‰ˆæœ¬ç›®å½•
ä¸ºæ¯ä¸ªæ¨¡å—åˆ›å»ºè¿ç§»è„šæœ¬ï¼š

```kotlin
// å°†æ‰€æœ‰ç¡¬ç¼–ç ç‰ˆæœ¬æ›¿æ¢ä¸ºç‰ˆæœ¬ç›®å½•å¼•ç”¨
// ä¾‹å¦‚ï¼š
// æ—§: implementation("androidx.room:room-runtime:2.6.1")
// æ–°: implementation(libs.room.runtime)
```

## ä¸‰ã€æ¨¡å—é…ç½®æ ‡å‡†åŒ–ï¼ˆP1çº§ - 2å¤©å†…å®Œæˆï¼‰

### 3.1 ç»Ÿä¸€æ¨¡å—ç»“æ„
æ¯ä¸ªfeatureæ¨¡å—å¿…é¡»éµå¾ªä»¥ä¸‹ç»“æ„ï¼š

```
feature-[name]/
â”œâ”€â”€ build.gradle.kts     # ä½¿ç”¨Conventionæ’ä»¶
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ main/
â”‚   â”‚   â”œâ”€â”€ kotlin/
â”‚   â”‚   â”‚   â””â”€â”€ com/ccxiaoji/feature/[name]/
â”‚   â”‚   â”‚       â”œâ”€â”€ api/          # å…¬å¼€API
â”‚   â”‚   â”‚       â”œâ”€â”€ data/         # æ•°æ®å±‚
â”‚   â”‚   â”‚       â”‚   â”œâ”€â”€ local/
â”‚   â”‚   â”‚       â”‚   â”œâ”€â”€ remote/
â”‚   â”‚   â”‚       â”‚   â””â”€â”€ repository/
â”‚   â”‚   â”‚       â”œâ”€â”€ di/           # ä¾èµ–æ³¨å…¥
â”‚   â”‚   â”‚       â”œâ”€â”€ domain/       # ä¸šåŠ¡é€»è¾‘
â”‚   â”‚   â”‚       â””â”€â”€ presentation/ # UIå±‚
â”‚   â”‚   â””â”€â”€ AndroidManifest.xml
â”‚   â””â”€â”€ test/                     # å•å…ƒæµ‹è¯•
â””â”€â”€ README.md                     # æ¨¡å—è¯´æ˜æ–‡æ¡£
```

### 3.2 åˆ›å»ºæ¨¡å—æ¨¡æ¿ç”Ÿæˆå™¨
åˆ›å»ºè„šæœ¬è‡ªåŠ¨ç”Ÿæˆæ ‡å‡†åŒ–çš„æ–°æ¨¡å—ï¼š

```bash
#!/bin/bash
# scripts/create_feature_module.sh
MODULE_NAME=$1
# ç”Ÿæˆæ ‡å‡†åŒ–çš„æ¨¡å—ç»“æ„å’Œé…ç½®æ–‡ä»¶
```

## å››ã€è‡ªåŠ¨åŒ–æ£€æŸ¥æœºåˆ¶ï¼ˆP2çº§ - 3å¤©å†…å®Œæˆï¼‰

### 4.1 åˆ›å»ºé…ç½®æ£€æŸ¥Gradleä»»åŠ¡
```kotlin
// buildSrc/src/main/kotlin/ConfigurationCheckTask.kt
abstract class ConfigurationCheckTask : DefaultTask() {
    @TaskAction
    fun checkConfiguration() {
        // æ£€æŸ¥æ‰€æœ‰æ¨¡å—æ˜¯å¦ï¼š
        // 1. ä½¿ç”¨ç‰ˆæœ¬ç›®å½•
        // 2. æœ‰ä¸€è‡´çš„ç¼–è¯‘å™¨é…ç½®
        // 3. Roomæ¨¡å—æœ‰room-compiler
        // 4. éµå¾ªæ ‡å‡†ç›®å½•ç»“æ„
    }
}
```

### 4.2 æ·»åŠ CI/CDæ£€æŸ¥
åœ¨GitHub Actionsä¸­æ·»åŠ é…ç½®æ£€æŸ¥ï¼š

```yaml
# .github/workflows/configuration-check.yml
name: Configuration Check
on: [push, pull_request]
jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: Check module configurations
        run: ./gradlew checkModuleConfigurations
```

### 4.3 åˆ›å»ºä¾èµ–åˆ†ææŠ¥å‘Š
```kotlin
// ç”Ÿæˆå„æ¨¡å—ä¾èµ–æŠ¥å‘Šï¼Œè¯†åˆ«ä¸ä¸€è‡´æ€§
task generateDependencyReport {
    doLast {
        // åˆ†æå¹¶ç”ŸæˆHTMLæŠ¥å‘Š
    }
}
```

## äº”ã€é•¿æœŸæ¶æ„ä¼˜åŒ–ï¼ˆP3çº§ - 1å‘¨å†…å®Œæˆï¼‰

### 5.1 å»ºç«‹æŠ€æœ¯å†³ç­–è®°å½•ï¼ˆADRï¼‰
åˆ›å»º`doc/adr/`ç›®å½•ï¼Œè®°å½•æ¯ä¸ªæŠ€æœ¯å†³ç­–ï¼š
- ADR-001: ä¸ºä»€ä¹ˆé€‰æ‹©Roomä½œä¸ºæ•°æ®åº“
- ADR-002: WorkManagerä½¿ç”¨åŸåˆ™
- ADR-003: æ¨¡å—é—´é€šä¿¡è§„èŒƒ

### 5.2 åˆ›å»ºå¼€å‘è€…æŒ‡å—
```markdown
# doc/developer-guide.md
## æ–°å¢æ¨¡å—checklist
- [ ] ä½¿ç”¨create_feature_module.shè„šæœ¬åˆ›å»º
- [ ] ä½¿ç”¨ccxiaoji.android.featureæ’ä»¶
- [ ] æ·»åŠ æ¨¡å—READMEè¯´æ˜ç”¨é€”
- [ ] è¿è¡Œé…ç½®æ£€æŸ¥ä»»åŠ¡
```

### 5.3 å®šæœŸæŠ€æœ¯å€ºåŠ¡å®¡æŸ¥
- æ¯æœˆæ‰§è¡Œä¸€æ¬¡æŠ€æœ¯å€ºåŠ¡å®¡æŸ¥
- ä½¿ç”¨å·¥å…·è‡ªåŠ¨è¯†åˆ«ï¼š
  - é‡å¤ä»£ç 
  - æœªä½¿ç”¨çš„ä¾èµ–
  - è¿‡æ—¶çš„APIè°ƒç”¨
  - é…ç½®ä¸ä¸€è‡´

## å…­ã€å®æ–½æ­¥éª¤å’Œæ—¶é—´è¡¨

### ç¬¬1å¤©ï¼šç´§æ€¥ä¿®å¤
- [ ] 09:00-09:30ï¼šä¿®å¤Roomç¼–è¯‘å™¨é—®é¢˜
- [ ] 09:30-10:00ï¼šéªŒè¯ç¼–è¯‘å’Œè¿è¡Œ
- [ ] 10:00-12:00ï¼šåˆ›å»ºConventionæ’ä»¶
- [ ] 14:00-17:00ï¼šå¼€å§‹ç‰ˆæœ¬ç›®å½•è¿ç§»

### ç¬¬2å¤©ï¼šæ ‡å‡†åŒ–å®æ–½
- [ ] 09:00-12:00ï¼šå®Œæˆæ‰€æœ‰æ¨¡å—ç‰ˆæœ¬ç›®å½•è¿ç§»
- [ ] 14:00-17:00ï¼šç»Ÿä¸€æ¨¡å—é…ç½®
- [ ] 17:00-18:00ï¼šç¼–å†™è¿ç§»æ–‡æ¡£

### ç¬¬3å¤©ï¼šè‡ªåŠ¨åŒ–å»ºè®¾
- [ ] 09:00-12:00ï¼šåˆ›å»ºé…ç½®æ£€æŸ¥ä»»åŠ¡
- [ ] 14:00-17:00ï¼šé›†æˆCI/CD
- [ ] 17:00-18:00ï¼šå›¢é˜ŸåŸ¹è®­

### ç¬¬4-5å¤©ï¼šä¼˜åŒ–å’Œæ–‡æ¡£
- [ ] å®Œå–„å¼€å‘è€…æŒ‡å—
- [ ] å»ºç«‹æŠ€æœ¯å†³ç­–è®°å½•
- [ ] åˆ›å»ºæ¨¡å—æ¨¡æ¿ç”Ÿæˆå™¨

## ä¸ƒã€æˆåŠŸæŒ‡æ ‡

### çŸ­æœŸæŒ‡æ ‡ï¼ˆ1å‘¨å†…ï¼‰
- âœ… æ‰€æœ‰æ¨¡å—ç¼–è¯‘æ— è­¦å‘Š
- âœ… 100%æ¨¡å—ä½¿ç”¨ç‰ˆæœ¬ç›®å½•
- âœ… é…ç½®æ£€æŸ¥ä»»åŠ¡0é”™è¯¯
- âœ… CI/CDé›†æˆå®Œæˆ

### é•¿æœŸæŒ‡æ ‡ï¼ˆ1æœˆå†…ï¼‰
- ğŸ“ˆ ç¼–è¯‘æ—¶é—´å‡å°‘20%
- ğŸ“ˆ æ–°æ¨¡å—åˆ›å»ºæ—¶é—´<5åˆ†é’Ÿ
- ğŸ“ˆ æŠ€æœ¯å€ºåŠ¡æ•°é‡æŒç»­ä¸‹é™
- ğŸ“ˆ ä»£ç å®¡æŸ¥é€šè¿‡ç‡>95%

## å…«ã€é£é™©å’Œç¼“è§£æªæ–½

### é£é™©1ï¼šè¿ç§»è¿‡ç¨‹å½±å“å¼€å‘è¿›åº¦
**ç¼“è§£**ï¼šåˆ†æ‰¹è¿ç§»ï¼Œä¼˜å…ˆä¿®å¤ä¸¥é‡é—®é¢˜

### é£é™©2ï¼šå¼€å‘è€…æŠµè§¦æ–°è§„èŒƒ
**ç¼“è§£**ï¼šæä¾›å……åˆ†åŸ¹è®­å’Œå·¥å…·æ”¯æŒ

### é£é™©3ï¼šè‡ªåŠ¨åŒ–å·¥å…·è¿‡äºä¸¥æ ¼
**ç¼“è§£**ï¼šè®¾ç½®åˆç†çš„è­¦å‘Šçº§åˆ«ï¼Œé€æ­¥æé«˜æ ‡å‡†

## ä¹ã€é¢„æœŸæ”¶ç›Š

### å³æ—¶æ”¶ç›Š
- ğŸš€ è§£å†³ç¼–è¯‘é—®é¢˜
- ğŸš€ æé«˜ä»£ç ä¸€è‡´æ€§
- ğŸš€ å‡å°‘é…ç½®é”™è¯¯

### é•¿æœŸæ”¶ç›Š
- ğŸ’ é™ä½ç»´æŠ¤æˆæœ¬
- ğŸ’ æé«˜å¼€å‘æ•ˆç‡
- ğŸ’ å¢å¼ºä»£ç è´¨é‡
- ğŸ’ ä¾¿äºæ–°äººä¸Šæ‰‹

## åã€åç»­è¡ŒåŠ¨

1. **ç«‹å³å¼€å§‹**ï¼šä¿®å¤Roomç¼–è¯‘å™¨é—®é¢˜
2. **æœ¬å‘¨å®Œæˆ**ï¼šç‰ˆæœ¬ç›®å½•è¿ç§»å’Œæ ‡å‡†åŒ–
3. **ä¸‹å‘¨å®Œæˆ**ï¼šè‡ªåŠ¨åŒ–æœºåˆ¶å»ºè®¾
4. **æŒç»­æ”¹è¿›**ï¼šå®šæœŸå®¡æŸ¥å’Œä¼˜åŒ–

---
*åˆ›å»ºæ—¶é—´ï¼š2025-06-20*
*è´Ÿè´£äººï¼šæŠ€æœ¯å›¢é˜Ÿ*
*çŠ¶æ€ï¼šå¾…æ‰§è¡Œ*